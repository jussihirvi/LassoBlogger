<?LassoScript //>// init variables (copied from index.lasso)Variable:'fromMetoRoot' = '';Include: $fromMetoRoot + 'config.lasso';Library: $fromMetoRoot + 'inc/library.inc';    // NOTE: includes in this file work with $fromMetoRoot    // for img tags etc. you must use     // ($basicOptions -> 'siteurl') /images etc.    // this is a bit messy...// get user level/*    NOTE: user levels DON'T WORK on this page    the associated tag will always return -1, because user cookies    cannot be read, because we are now in "virtual directory" that is    different from the directory specified in cookies!    Practical result: no edit links in permalink files*/Variable:'userInfo' = LB_Userinfo;Variable:'use_level' = $userInfo -> LB_getUse_level;//  'test: ul = '; $use_level; '<br>';// init the basic options datatypeVariable:'basicOptions' = LB_basicOptions;    Variable:'page_title'=(str:'Welcome');Variable:'pageSecuritylevel' = 1; // available to the users of same level & upVariable:'rectype_en' = 'post';Variable:'rectype_en_part' = 'posts';Variable:'rectype_fi' = 'artikkeli';Variable:'rectype_fi_part' = 'artikkeleita';Variable:'speakBubble' = '';// myStyleSheet: we must know first the depth of virtual address!Variable:'header'= $fromMetoRoot + 'inc/header.inc';Variable:'menu'=  $fromMetoRoot + 'inc/menu.lasso';Variable:'footer'=  $fromMetoRoot + 'inc/footer.inc';Variable:'myInc' = $fromMetoRoot + 'inc/';Variable:'myImages' = $fromMetoRoot + 'images/';// Variable:'myThemeImages' =   $fromMetoRoot + 'themes/default/images';Variable:'error' = (Integer);Variable:'errorText' = (String);// init other variables (these are not from index.lasso)Var:'skip' = '';Var:'perma' = 'yes'; // case will be "perma"// if this file is served, error is -9984 (file not found)// error.lasso at your domain root has pointed us to this fileVariable:'filepath' = (Action_Param:'filepath');Variable:'siteurl' 		= ($basicOptions -> 'siteurl');If: !($filepath -> (BeginsWith: $siteurl));    // the requested link is outside LassoBlogger    // so show some generic error information    '<p class="center" style="padding-top:30px;">';	'The file was not found.<br><br>';	'The requested filepath was ';  $filepath; '<br>';	'This error code was printed by the file permalink_handler.lasso';    '</p>';Else;	// LassoBlogger stuffVar:'permaStruct' 	= ($basicOptions -> 'permalink_structure');$permaStruct -> (RemoveLeading:'/');Var:'aPermaStruct'	= $permaStruct -> (Split:'/');// capture error: if option "permalink_structure" has empty valueIf: $permaStruct == '';    $speakBubble = 'The permalink structure has not been defined in blog options. You may have an old link. Go to the <A HREF="' + ($basicOptions -> 'siteurl') + '">front page</A> and try to search for the post by its title.';    Include:$myInc + 'speakBubble.inc';    Abort;/If;$filepath -> (RemoveLeading: $siteurl);Var:'aFilepath' 	= $filepath -> (Split:'/');// 'test: '; $aFilepath; '<br>';// 'test: '; $aPermaStruct; '<br>';Var:'i'= (String), 'lc' = (Integer), 'myPermaStructItem' = '';Var:'year' = '', 'monthnum' = '', 'day' = '', 'postname' = '', 'postid' = '';Iterate: $aFilepath, $i;    $lc += 1;    $myPermaStructItem = $aPermaStruct -> (Get:$lc);    If: $myPermaStructItem -> (Get:1) == '%'; 	    //otherwise (".lasso" etc.) do nothing	    // available: /%year%/%monthnum%/%day%/%postname%/ /%postid%  	If: $myPermaStructItem == '%year%';	    $year = $i;	Else: $myPermaStructItem == '%monthnum%';	    $monthnum = $i;	Else: $myPermaStructItem == '%day%';	    $day = $i;	Else: $myPermaStructItem == '%postname%';	    $postname = $i;	Else: $myPermaStructItem == '%postid%';	    $postid = $i;	/If;    /If;/Iterate;// 'search items: year='; $year; ', monthnum='; $monthnum; ', day='; $day;// ', postname='; $postname; ', postid='; $postid; '<br>';// assemble $searchArgsVar: 'searchArgs' = (Array);If: $postname != '';    $searchArgs -> (Insert: 'pos_name' = $postname);/If;If: $postid != '';    $searchArgs -> (Insert: 'id' = $postid);/If;If: $year != '' && (Date:$year) -> Type == 'Year';	// we have a date    Var:'startDate' = (Date);    Var:'endDate' = (Date);    If: $monthnum == ''; 	// only year is known	$startDate = (Date:($year + '-' + '01' + '-' + '01' ));	$endDate   = (Date:(((Integer:$year)+1) + '-' + '01' + '-' + '01' ));    Else: $day == '';		// year and month are known	$startDate = (Date:($year + '-' + $monthnum + '-' + '01' ));	If: $monthnum == '12';	    Variable:'endDate' =	     (Date:(((Integer:$year) + 1) + '-' + '1' + '-' + '1' ));	Else;	    Variable:'endDate' = 	      (Date:($year + '-' + ((Integer:$monthnum) + 1) + '-' + '1' ));	/If;    Else;			// year, monthnum, day are known	$startDate = (Date:($year + '-' + $monthnum + '-' + $day ));	$endDate   = (Date:($year + '-' + $monthnum + '-' + ((Integer:$day)+1)));    /If;    $searchArgs -> (Insert: '-Operator' = 'gte');    $searchArgs -> (Insert: 'pos_date' = (Date_Format:$startDate,-Format='%Q %T'));    $searchArgs -> (Insert: '-Operator' = 'lt');    $searchArgs -> (Insert: 'pos_date' = (Date_Format:$endDate,-Format='%Q %T'));    $searchArgs -> (Insert: '-OpBegin' = 'or');    $searchArgs -> (Insert: 'pos_status' = 'publish');    $searchArgs -> (Insert: 'pos_status' = 'static');    $searchArgs -> (Insert: '-OpEnd' = 'or');/If;	// end date// searchArgs is ready//    'test: SearchArgs = '; $searchArgs; '<br>';// myStyleSheet: we need magic    $fromMetoRoot ='';     Loop:$lc;	If: (Loop_Count) != 1;	    $fromMetoRoot += '../';	/If;    /Loop;    Var:'myStylesheet' = $fromMetoRoot + 'themes/default/style.css'; // now build the pageVariable:'permaSearchArgs' = $searchArgs; 	// because $searchArgs will be reset at the beginning of cont/index.inc    Variable:'contents' = 'cont/index.inc';    Include: 'gen/frame_default.inc';/If; 	// end if-this-is-LassoBlogger?>