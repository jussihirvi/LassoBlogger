<?LassoScript //>Variable:'fromMetoRoot' = '../';Include:'../config.lasso';Include:'../gen/session.inc';Library:'../inc/library.inc';Variable:'myStylesheet' = 'admin.css';Variable:'myInc' = 'inc/';Variable:'myImages' = 'images/';// init the basic options datatypeVariable:'basicOptions' = LB_basicOptions;Variable:'menu'  = $fromMetoRoot + $myInc + 'adminmenu.lasso';Variable:'footer'= $fromMetoRoot + $myInc + 'adminfooter.inc';// some values here override those in config.lassoVariable:'contents'= $fromMetoRoot + 'gen/adminpage_monster.inc';If: $lang == 'fi';Variable:'page_title'='Tiedostojen lataus';Else;Variable:'page_title'='File Uploads';/If;Variable:'pageSecuritylevel' = (Integer:(LB_GetOption:'fileupload_minlevel')); Variable:'rectype_en' = 'file';Variable:'rectype_en_part' = 'files';Variable:'rectype_fi' = 'tiedosto';Variable:'rectype_fi_part' = 'tiedostoja';Variable:'viewtype' = 'formview'; // formview, listviewVariable:'maxrecords_formview' = 1;   Variable:'maxrecords_listview' = 25;   Variable:'dbtype' = 'mysql';   // fmp, mysql (vaikuttaa pvm-k‰sittelyynVariable:'updatebehavior' = 1;   // 1 or 2 (see below)// behavior #1: search kept, updated rec shown only if search allows this// 		(keyvalue nulled after update)//		(good for listview)// behavior #2: search bypassed, only updated rec shown// 		(keyvalue kept, hakulomake emptied)//		(sopii formview-n‰kym‰‰n)Variable:'searchBehavior' = 1;   // 1 or 2 (see below)// searchBehavior #1: if searchform is empty, then find all// searchBehavior #2: if searchform is empty, then find nothingVariable:'action' = '';Variable:'speakBubble' = '';Variable:'keyvalue'=(Action_Param:'keyvalue');Variable:'skip'=(Action_Param:'skip');Variable:'haku'=(Action_Param:'haku');Variable:'size1default'='400px'; // default (text: size, textarea: cols)Variable:'size2default'='4';  // default (textarea: rows)Variable:'myTable'='uploads';Variable:'publicPage'=''; // don't comment outVariable:'defaultClass'='pieni'; // normaalisti "pieni" // for how to use $searchFields and $editFields, // see the beginning of adminpage_monster.inc// search formVariable:'searchFields'=(Array:(Array:'id','ID','hidden','','','','','','','','eq'),(Array:'upl_catid','catID','hidden','','','','','','','','eq'),);// following code throws error "Recursion depth limit (10) exceeded" at (LB_getOption:'default_category') (noticed by Doug Gentry)// trying to go round it (see below)// Variable:'categ_temp' = '[If: $emptyform == \'yes\'][Var:\'comparisonValue\'= (LB_getOption:\'default_category\')][Else][Var:\'comparisonvalue\' = $fieldValue][/If][Inline:-FindAll,$dbConfig,-table=$table_prefix + \'categories\',//     -KeyField=\'id\',-SortField=\'cat_name\']// 	<select name="pos_category" size="1">// 	    [Records]// 		<option value="[Field:\'id\']"[If: $comparisonValue == // 		  (Field:\'id\')] SELECTED[/If]>[Field:\'cat_name\']</option>// 	    [/Records]// 	</select>//     [/Inline]';Variable:'cat_temp' = "[If: $emptyform == 'yes'][Var:'comparisonValue'= '-1'][Else][Var:'comparisonvalue' = $fieldValue][/If]    [If: $emptyform == 'yes']Post-related    <input type=\"hidden\" name=\"upl_catid\" value=\"-1\">    [Else]    [Inline:-FindAll,$dbConfig,-table=$table_prefix + 'uploadcats',      -KeyField='id',-SortField='upc_name']	<select name=\"upl_catid\" size=\"1\">		<option value=\"-1\"[If: $fieldvalue ==		  \"-1\"] SELECTED[/If]>None (post-related file)</option>	    [Records]		<option value=\"[Field:'id']\"[If: $fieldvalue ==		  (Field:'id')] SELECTED[/If]>[Field:'upc_name']</option>	    [/Records]	</select>    [/Inline]    [/If]";Variable:'user_temp' = '    [If: $emptyform == \'yes\']	[Var:\'myuser\' = $user_ses]	[Else]	[Var:\'myuser\' = $fieldvalue]    [/If]    [Inline:-search,$dbConfig, -table=$table_prefix + \'users\',    -KeyField=\'id\',\'id\'=$myuser]    <A HREF="use-edit.lasso?id=[Field:\'id\']" TITLE="See user data">    [Field:\'use_nickname\']</A>    [/Inline]    <input type="hidden" name="upl_userid" value="[$myuser]">    ';Variable:'postid_temp' = "    [If: (Field:'upl_catid') == '-1']    [Inline:-search,$dbConfig, -table=$table_prefix + 'posts',    -KeyField='id','id'=$fieldvalue]    <A HREF=\"man-postedit.lasso?id=[$fieldvalue]\" TITLE=\"See the post\">    [Field:'pos_title']</A>, id =     <input type=\"text\" name=\"upl_postid\" value=\"[$fieldvalue]\" style=\"width:50px;\">    [/Inline]    [Else]    (not relevant for this file)    [/If]";// edit formVariable:'editFields'=(Array:(Array:'id','ID','nosave','','','','','',''),(Array:'upl_catid','File Category','override','','','','','',$cat_temp),(Array:'upl_postid','To Post','nosave','','','','','',$postid_temp),(Array:'upl_name','Filename','text','req','','','<b>Caution:</b> the database entry (modified here) must match the actual filename!<br><A HREF="[Field:\'upl_path\'][Field:\'upl_name\']" TARGET="_blank">Show the file (in a new window)!</A>','',''),(Array:'upl_path','Path','text','req','','','','',''),(Array:'upl_description','Description','text','','','','','',''),(Array:'upl_customsortcode','Custom sort code','text','','40px','','','',''),(Array:'upl_userid','Uploaded by','override','','','','','',$user_temp),(Array:'upl_modified','Last modified','moddate','','','','','date',''),(Array:'upl_imagedisplay','Image Display','select','','right;left;block;link;none','display: right side of post;display: left side of post;display: center of post;no display: show link to file; no display','Relevant only for image files','',''),(Array:'upl_linkurl','Link URI','text','','','','Use this to make a post-related image into a link (typically it would point to a big version of an image). If the value does not begin with "http://" or a slash (/), it is relative to the	path that is <a href="opt-uploads.lasso">set in the option</a> <code>fileupload_realpath</code> (current value: <b>[LB_getOption:\'fileupload_realpath\']</b>)','',''),);// add formVariable:'addFields'=$editFields;// define sorting for the main search inlineVariable:'sortstuff' = (Array:'-sortfield' = 'id','-sortorder' = 'descending');Variable: 'defaultSearch' = (Array);	// userlevel adjustments// none//  buttonlist (say 'yes' or 'no' to each item)Variable:'buttonlist' = (Array:'add'='no','update'='yes','delete'='yes');// Variable:'formTargetpage' = '';   // if target=self, comment this outVariable:'customValidations' = 'no'; 	// if yes, the associated include file must be in placeVariable:'customPostprocess' = 'yes'; Variable:'allowFileupload' = 'yes';		    Variable:'uploadForm' = 'yes'; // always show it (even for empty form)Include:'../gen/frame_admin.inc';?>