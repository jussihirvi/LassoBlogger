<?LassoScriptloop(1); // hack for imitating abort on L9// begin tags (LO_ means local to the file)  Define_Tag('LO_field',    -Required='table',                             -Required='name',                             -Required='type',                             -Optional='default');    if(! local_defined('default')); local('default') = string; /if;    local('sql') = 'ALTER TABLE '+$myDb+'.'+$table_prefix+#table;    #sql += ' ADD '+ #name+' '+#type + ' NOT NULL';     if(#default);      #sql += ' DEFAULT \'' + #default + '\'';    /if;    #sql += ';\n';    return(#sql);  /Define_Tag;  Define_Tag('LO_errorMessage',-encodeNone);    local('out') = ('<span class="red">' + error_code + ', ' + error_msg       + '.<br>\n' + '</span>');    error_reset;    return(#out);  /Define_Tag;  Define_Tag( 'LB_addOption',     -Required='optionName',                                  -Required='optionValue',                                  -Required='optionDescription',                                  -Optional='optionStatus',                                  -Optional='optionGroup');    local('error' = string);    if(! local_defined('optionStatus'));      local('optionStatus' = string);    /if;    if(! local_defined('optionGroup'));      local('optionStatus' = 'misc');    /if;    inline(-add,$dbconfig,        -table=$table_prefix + 'options',        'opt_name'=#optionName,        'opt_value'=#optionValue,        'opt_description'=#optionDescription,        'opt_status' = #optionStatus,        'opt_group' = #optionGroup);        if( error_msg != error_noerror );           #error = 'An error occurred while trying to add the option ';           #error += #optionName + ' to the "' + $table_prefix + 'options" table.<br>';           #error +='More info: ' + LO_errorMessage;        /If;    /inline;    return(#error);  /define_tag;  Define_Tag('LO_index',-required='table',                        -required='field',                        -optional='indextype',                        -optional='content',                        -encodeNone);    // return sql code for creating a db index    if(! local_defined('content'));   local('content')   = #field;  /if;    if(! local_defined('indextype')); local('indextype') = 'INDEX'; /if;    return('ALTER TABLE ' + $table_prefix + #table + ' ADD '           + #indextype + ' ' + #field + ' (' + #content + ');\n');  /Define_Tag;// end tagsvar('abort')   = string;var('alertcolor')   = string;var('aTables') = Array('categories','comments','linkcategories','links','options','post2cat','postmeta','posts','users','uploadcats','uploads');var('step') = integer;if( action_param('step') );  $step = integer(action_param('step'));/if;// has this installer been run already?  // begin checking    inline($dbConfig,-table=$table_prefix+'users',-findall);      var('fc') = found_count;    /inline;    error_reset;    if( $fc );        '<p class="red"><strong>It seems that this installer has already been run.</strong> If this is not the case, or if you for some reason want to run it again, you have to manually remove (or bracket out) this checking code from the beginning of <code>admin/install_stuff.inc</code>.Or, as another possibility, delete the database and then rerun this installer to recreate it.</p>';    loop_continue;    /if;  // end checkingIf( ! $step );          // step 0// test inlineinline($dbConfig, -table='testvalue', -findAll);  var('currentStatus') = string;  if( error_code == (-3000) || error_code == 1146); // latter is for L9    $currentStatus = 'The database <b>' + $myDb + '</b> seems to exist. Follow the directions below, and proceed with the first step. The first step can be a little <b>slow</b>, so be patient!';    $alertcolor = 'green';  else( error_code == (-609) );    $currentStatus = 'The database was not found. Follow the directions below to make it appear. You can reload this page to see the result. (Lasso returned the error code -609)';         $alertcolor = 'red';  else( error_msg != error_noerror );    'Error  '  + ': ' + LO_errorMessage;    $alertcolor = 'red';  /if;/inline;?><p>Welcome to LassoBlogger installer. We&#8217;re now going to go through a few steps to get you up and running with the best Lasso-based personal publishing platform (am I right?).</p><p>For pre-9 versions of Lasso, you are going to need access to Lasso's admin pages to get through this installation. If you haven't that access, please contact your Internet Service Provider and ask them to run this installer for you. </p> <p>Did you already review your <code>config.lasso</code> and fill in the necessary variables? If not, do that now! </p><p class="[$alertcolor]"><strong>Current status: </strong>[$currentStatus]</p>[$alertcolor = string]<h2>For Lasso 9.x</h2><p>If not done already, please create the database and make it available to Lasso.</p><h2>For earlier versions of Lasso</h2><p>If not done already, please do this on Lasso's admin pages (SiteAdmin)<br>         <strong>1. Create and enable the database</strong><br>        - in Lasso 8.5, databases are created in DatabaseBrowser.lassoapp, and enabled in SiteAdmin.lassoapp<br>        - the name must match the one that you stored in <code>config.lasso</code><br>         <strong>2. Create the group and user</strong> (if they don't yet exist)<br>        - the user name and password must match the ones you stored in <code>config.lasso</code><br>        <strong>3. Assign privileges</strong><br>        - give your new group ALL rights to the new db ("all rights" means: Show Schema, Search, Add, Update, Delete, AND Execute Scripts)<br>        - also you must give your group the right to use SQL (in Lasso SiteAdmin, that privilege is assigned on the hosts level). Right to use SQL is currently (as of v0.8.0) <strong>only</strong> needed for the time of the install process <br>        <strong>4. If the database is still not found, check that your database is enabled in the same Lasso site that your domain belongs to</strong><br>        </p>        <h2 class="step"><a href="install.lasso?step=1">Take the first  step<br>(create tables & fields)!</a></h2><?LassoScriptelse($step == 1);               // end step 0, begin step 1// now tables will be created// create tables  var('SQL') = string;  iterate($aTables,var('i'));    $SQL += 'CREATE TABLE ' + $myDb + '.' + $table_prefix + $i + ' (\n';    $SQL += '  ID bigint(20) unsigned NOT NULL auto_increment, \n';    $SQL += '  PRIMARY KEY (ID));\n';  /iterate;  inline($dbConfig, -sql=$SQL);                  if( error_msg != Error_NoError );                    '<p class="red">Error in creating tables: ';                       LO_errorMessage;                    '</p>';                /if;  /inline;var('SQL') = string; // resetvar('t') = 'categories';$SQL += LO_field($t,'cat_name','VARCHAR(55)');$SQL += LO_field($t,'cat_nicename','VARCHAR(200)');$SQL += LO_field($t,'cat_description','TEXT');$SQL += LO_field($t,'cat_parent','INT(4)','0');$SQL += LO_field($t,'cat_sortorder','VARCHAR(255)','descending');var('t') = 'comments';$SQL += LO_field($t,'com_post_ID','INT(11)','0');$SQL += LO_field($t,'com_author','TINYTEXT');$SQL += LO_field($t,'com_author_email','VARCHAR(100)');$SQL += LO_field($t,'com_author_url','VARCHAR(200)');$SQL += LO_field($t,'com_author_IP','VARCHAR(100)');$SQL += LO_field($t,'com_date','DATETIME','0000-00-00 00:00:00');$SQL += LO_field($t,'com_date_gmt','DATETIME','0000-00-00 00:00:00');$SQL += LO_field($t,'com_title','VARCHAR(255)');$SQL += LO_field($t,'com_content','TEXT');$SQL += LO_field($t,'com_karma','INT(11)','0');$SQL += LO_field($t,'com_approved','ENUM(\'0\',\'1\',\'spam\')','1');$SQL += LO_field($t,'com_agent','VARCHAR(255)','');$SQL += LO_field($t,'com_type','VARCHAR(20)');$SQL += LO_field($t,'com_parent','INT(11)','0');$SQL += LO_field($t,'com_user_id','INT(11)','0');var('t') = 'linkcategories';$SQL += LO_field($t,'cat_name','TINYTEXT');$SQL += LO_field($t,'auto_toggle','ENUM(\'Y\',\'N\')','N');$SQL += LO_field($t,'show_images','ENUM(\'Y\',\'N\')','Y');$SQL += LO_field($t,'show_description','ENUM(\'Y\',\'N\')','N');$SQL += LO_field($t,'show_rating','ENUM(\'Y\',\'N\')','Y');$SQL += LO_field($t,'show_updated','ENUM(\'Y\',\'N\')','Y');$SQL += LO_field($t,'sort_order','VARCHAR(64)','rand');$SQL += LO_field($t,'sort_desc','ENUM(\'Y\',\'N\')','N');$SQL += LO_field($t,'text_before_link','VARCHAR(128)','<li>');$SQL += LO_field($t,'text_after_link','VARCHAR(128)','<br />');$SQL += LO_field($t,'text_after_all','VARCHAR(128)','</li>');$SQL += LO_field($t,'list_limit','INT(11)','-1');var('t') = 'links';$SQL += LO_field($t,'lin_url','VARCHAR(255)');$SQL += LO_field($t,'lin_name','VARCHAR(255)');$SQL += LO_field($t,'lin_image','VARCHAR(255)');$SQL += LO_field($t,'lin_target','VARCHAR(25)');$SQL += LO_field($t,'lin_category','INT(11)','0');$SQL += LO_field($t,'lin_description','VARCHAR(255)');$SQL += LO_field($t,'lin_visible','ENUM(\'Y\',\'N\')','Y');$SQL += LO_field($t,'lin_owner','INT(11)','1');$SQL += LO_field($t,'lin_rating','INT(11)','0');$SQL += LO_field($t,'lin_updated','DATETIME','0000-00-00 00:00:00');$SQL += LO_field($t,'lin_rel','VARCHAR(255)');$SQL += LO_field($t,'lin_notes','TEXT');$SQL += LO_field($t,'lin_rss','VARCHAR(255)');var('t') = 'options';$SQL += LO_field($t,'opt_blog_id','INT(11)','0');                        // in v050829 was: blog_id$SQL += LO_field($t,'opt_name','VARCHAR(64)');$SQL += LO_field($t,'opt_can_ovSQL','ENUM(\'Y\',\'N\')','Y');$SQL += LO_field($t,'opt_type','INT(11)','1');$SQL += LO_field($t,'opt_value','varchar(255)');$SQL += LO_field($t,'opt_width','INT(11)','20');$SQL += LO_field($t,'opt_height','INT(11)','8');$SQL += LO_field($t,'opt_description','TEXT');$SQL += LO_field($t,'opt_status','VARCHAR(255)');$SQL += LO_field($t,'opt_admin_level','INT(11)','1');$SQL += LO_field($t,'opt_autoload','ENUM(\'yes\',\'no\')','yes');$SQL += LO_field($t,'opt_group','ENUM(\'gene\',\'writ\',\'read\',\'disc\',\'perm\',\'file\',\'misc\')','gene');        // v0.8.0$SQL += LO_field($t,'opt_sortcode','VARCHAR(255)');        // v0.8.0var('t') = 'post2cat';$SQL += LO_field($t,'p2c_post_id','BIGINT(20)','0');$SQL += LO_field($t,'p2c_category_id','BIGINT(20)','0');var('t') = 'postmeta';$SQL += LO_field($t,'met_post_id','BIGINT(20)','0');$SQL += LO_field($t,'met_key','VARCHAR(255)'); $SQL += LO_field($t,'met_value','TEXT');var('t') = 'posts';$SQL += LO_field($t,'pos_author','INT(4)','0');$SQL += LO_field($t,'pos_date','DATETIME','0000-00-00 00:00:00');$SQL += LO_field($t,'pos_date_gmt','DATETIME','0000-00-00 00:00:00');        // in 0.5.0 was TEXT (=max 64k instead of 24M)$SQL += LO_field($t,'pos_content','LONGTEXT');$SQL += LO_field($t,'pos_title','TEXT');$SQL += LO_field($t,'pos_category','INT(4)','0');$SQL += LO_field($t,'pos_excerpt','TEXT');$SQL += LO_field($t,'pos_status','ENUM(\'publish\',\'draft\',\'private\',\'static\',\'object\')','publish');$SQL += LO_field($t,'pos_comment_status','ENUM(\'open\',\'closed\',\'registered_only\')','open');$SQL += LO_field($t,'pos_ping_status','ENUM(\'open\',\'closed\')','open');$SQL += LO_field($t,'pos_password','VARCHAR(20)');$SQL += LO_field($t,'pos_name','VARCHAR(200)');$SQL += LO_field($t,'pos_to_ping','TEXT','');$SQL += LO_field($t,'pos_pinged','text');$SQL += LO_field($t,'pos_modified','DATETIME','0000-00-00 00:00:00');$SQL += LO_field($t,'pos_modified_gmt','DATETIME','0000-00-00 00:00:00');$SQL += LO_field($t,'pos_content_filtered','TEXT');$SQL += LO_field($t,'pos_parent','INT(11)','0');$SQL += LO_field($t,'pos_guid','VARCHAR(255)');$SQL += LO_field($t,'pos_menu_order','INT(11)','0');var('t') = 'users';$SQL += LO_field($t,'use_login','VARCHAR(60)');$SQL += LO_field($t,'use_pass','VARCHAR(64)');$SQL += LO_field($t,'use_firstname','VARCHAR(50)');$SQL += LO_field($t,'use_lastname','VARCHAR(50)');$SQL += LO_field($t,'use_nickname','VARCHAR(50)');$SQL += LO_field($t,'use_nicename','VARCHAR(50)');$SQL += LO_field($t,'use_icq','INT(10)','0');$SQL += LO_field($t,'use_email','VARCHAR(100)');$SQL += LO_field($t,'use_url','VARCHAR(100)');$SQL += LO_field($t,'use_ip','VARCHAR(15)');$SQL += LO_field($t,'use_domain','VARCHAR(200)');$SQL += LO_field($t,'use_browser','VARCHAR(200)');$SQL += LO_field($t,'use_registered','DATETIME','0000-00-00 00:00:00');$SQL += LO_field($t,'use_level','INT(4)','0');$SQL += LO_field($t,'use_aim','VARCHAR(50)');$SQL += LO_field($t,'use_msn','VARCHAR(100)');$SQL += LO_field($t,'use_yim','VARCHAR(50)');$SQL += LO_field($t,'use_idmode','VARCHAR(20)');$SQL += LO_field($t,'use_activation_key','VARCHAR(60)');$SQL += LO_field($t,'use_status','INT(11)','0');        // in WP, LONGTEXT$SQL += LO_field($t,'use_description','TEXT');var('t') = 'uploadcats';$SQL += LO_field($t,'upc_name','VARCHAR(55)');$SQL += LO_field($t,'upc_nicename','VARCHAR(200)');$SQL += LO_field($t,'upc_description','LONGTEXT');$SQL += LO_field($t,'upc_parent','INT(5)');$SQL += LO_field($t,'upc_sortorder','VARCHAR(255)','descending');var('t') = 'uploads';$SQL += LO_field($t,'upl_catid','INT(4)');$SQL += LO_field($t,'upl_postid','BIGINT(20)');$SQL += LO_field($t,'upl_name','VARCHAR(60)');$SQL += LO_field($t,'upl_path','VARCHAR(255)');$SQL += LO_field($t,'upl_description','VARCHAR(255)');$SQL += LO_field($t,'upl_customsortcode','VARCHAR(255)');$SQL += LO_field($t,'upl_created','DATETIME');$SQL += LO_field($t,'upl_modified','DATETIME');$SQL += LO_field($t,'upl_userid','INT(4)');$SQL += LO_field($t,'upl_imagedisplay','ENUM(\'right\',\'left\',\'block\',\'link\',\'none\')');$SQL += LO_field($t,'upl_linkurl','VARCHAR(255)');$SQL += LO_field($t,'upl_posttable','VARCHAR(255)');inline($dbConfig, -sql=$SQL);                 if( error_msg != Error_NoError );                    '<p class="red">Error in creating fields: ';                       LO_errorMessage;                    '</p>';                /if;/inline;  // error handler for step 1  var('temp_errorFlag') = string;  if( error_msg != Error_NoError );    'An error occurred in step 1: ';    if( error_code == (-9961) );      'You don\'t have permission for the action. <strong>Please go back and verify that you have assigned the user permissions as specified</strong>.<br>Error was -9961 (' + error_msg + ').<br>';     else;      LO_errorMessage;    /if;    'You are free to try step 2, if you think the table structure is ready in spite of this error message.<br>';    var('temp_errorFlag') = 'err';  /if;// create indexes. First collect sql to a string varvar('SQL') = string;$SQL += LO_index('categories','cat_nicename');$SQL += LO_index('comments','com_approved');$SQL += LO_index('comments','com_post_ID');$SQL += LO_index('links','lin_category');$SQL += LO_index('links','lin_visible');$SQL += LO_index('options','opt_name');$SQL += LO_index('post2cat','p2c_post_id',-content='p2c_post_id,p2c_category_id');$SQL += LO_index('postmeta','met_post_id');$SQL += LO_index('postmeta','met_key');$SQL += LO_index('posts','pos_name');$SQL += LO_index('posts','pos_title',-indextype='FULLTEXT');$SQL += LO_index('posts','pos_excerpt',-indextype='FULLTEXT');$SQL += LO_index('posts','pos_content',-indextype='FULLTEXT');$SQL += LO_index('posts','pos_combined',-indextype='FULLTEXT',-content='pos_title,pos_excerpt,pos_content');$SQL += LO_index('users','use_login');$SQL += LO_index('uploadcats','upc_nicename');$SQL += LO_index('uploads','upl_postid');$SQL += LO_index('uploads','upl_name');$SQL += LO_index('uploads','upl_customsortcode');// do it            inline($dbConfig, -SQL=$SQL);                      if( error_msg != Error_NoError );                    '<p class="red">Error in creating indexes: ';                       LO_errorMessage;                    '</p>';                  $temp_errorFlag = 'err';              /if;            /inline;// the next is to make lasso refresh the security cache// any action will do, if it only refers to some of the new tables (or any nonexistent table?) if( ! $temp_errorFlag );    inline($dbConfig, -table=$table_prefix + 'options',-show);    /inline;/if; ?><p>[if( ! $temp_errorFlag )]Good. The tables have been created.[/if]</p><h2>For pre-9 versions of Lasso</h2><p>[if( ! $temp_errorFlag )]Now[else]After the tables have been created,[/if] you must do the following:<br><strong>1. Give your user group ALL rights to ALL the new tables</strong> (and don't forget that there are more tables than ten!)<br>- on Lasso's SiteAdmin pages, you might have to press the Refresh button first to make the new tables appear<br></p>        <h2 class="step"><a href="install.lasso?step=2">Take the second step (optimize & analyze tables)!</h2><?LassoScriptElse( $step == 2 );              // end step 1, begin step 2// analyze & optimize seems to succeed ok even when the user// hasn't yet given all table rights (050830)var('temp_errorFlag') = string;// *** optimize tables ***        var('SQL') = string;        iterate($aTables,var('i'));          $SQL = 'OPTIMIZE TABLE ' + $myDb + '.' + $table_prefix + $i;          inline($dbConfig, -SQL=$SQL);                if( error_msg != error_noError );                    '<p class="red">';                      'Error in optimize, table ' + $table_prefix + $i + ': ';                      LO_errorMessage;                    '</p>';                  $temp_errorFlag = 'err';              /if;          /Inline;        /Iterate;// *** analyze tables ***        var('SQL') = string;        iterate($aTables,Var('i'));          $SQL = 'ANALYZE TABLE ' + $myDb + '.' + $table_prefix + $i;          inline($dbConfig, -SQL=$SQL);                    if( error_msg != Error_NoError );                    '<p class="red">';                      'Error in analyze, table ' + $i + ': '; LO_errorMessage;                    '</p>';                  $temp_errorFlag = 'err';              /if;          /inline;        /iterate;?>[If( $temp_errorFlag == 'err')]<p>Some errors were detected. You should check what they are about (the developers will be interested to hear about this!) If you think everything is ok, please continue: fill in the form below and take the next step.</p>[Else]<p>That went probably very fast. No errors were detected. Next you should fill in the form below and submit it.</p>[/If] <form id="setup" method="post" action="install.lasso?step=3"><table width="100%"><tr>  <th width="33%">Blog title:</th>  <td>    <input type="hidden" name="-required">    <input name="blog_title" type="text" id="blog_title" size="25" />  </td></tr><tr>  <td>&nbsp;</td>  <td><em>You can always change it later</em></td></tr><tr>  <th>Your e-mail:</th>  <td>    <input type="hidden" name="-required">    <input name="admin_email" type="text" id="admin_email" size="25" />  </td></tr><tr>  <td>&nbsp;</td>  <td><em>Double-check that email address before continuing</em></td></tr></table><h2 class="step"><input type="submit" name="Submit" value="Take the third step" /></h2></form><?LassoScriptelse($step == 3);               // end step 2, begin step 3/* now the db, tables, and fields are ready. Now we process form data,create sample data,and give the user his admin username:password?first: check that there are some permissions given to tables:*/inline(-show,$dbConfig,-table=$table_prefix+'posts');    if( error_code == (-9961) );       'An error occurred.<br>';       'The table privileges were tested using the "';       $table_prefix; 'posts" table and "show" action as an example.';       'It seems there are not enough privileges. This is something you\'d ' +          'better correct before continuing.<br>';        'Then you can try to reload this page.';       $abort = 'yes';   else( error_msg != Error_NoError );       'An error occurred.<br>';       'More info: ' + LO_errorMessage;       $abort = 'yes';   /if;/inline;if($abort); loop_continue; /if; // page aborted// capture form data (they will be written to db etc.)var( 'blog_title' = action_param('blog_title'),    'admin_email' = action_param('admin_email'));// todo - add email validation routine// todo - add basic text validation routine// path to front page    var('pathToblog') = $pathTome;    $pathToblog -> RemoveTrailing('admin/');// set and save optionsvar('err') = string;$err += LB_addOption('siteurl',$pathtoBlog,'Where your blog can be found on the net','works','gene');    if( $err );        $err;  // the ctag has returned an error - show it, and abort        loop_continue;    /if;$err += LB_addOption('blogname',$blog_title,'The title of your blog','works','gene');$err += LB_addOption('admin_email',$admin_email,'This is important','works','gene');$err += LB_addOption('blogdescription','Just another blog','In a few words, explain what your blog is about','works','gene');$err += LB_addOption('theme','default','Path for stylesheet and images. No slash at beginning or end','works','gene');$err += LB_addOption('facebook_app_id','','Facebook application ID, needed for Facebook integration','works','gene');$err += LB_addOption('facebook_app_secret','','Facebook application secret (you get this from Facebook)','works','gene');$err += LB_addOption('users_can_register', 0, 'Anyone can register (0 or1)','works','gene');$err += LB_addOption('gmt_offset', 0,'Times in the weblog should differ by (number of hours)','','gene');$err += LB_addOption('date_format','%m/%d/%Y','If not the standard format. Consult Lasso\'s Date_Format tag. Example:<code>%d.%m.%Y</code>','works','gene');$err += LB_addOption('time_format','%H:%M:%S','If not the standard format. Example: <code>%h:%M %p</code>','works','gene');$err += LB_addOption('start_of_week', 1,'0 for sunday, 1 for monday etc.','','gene');// writing options $err += LB_addOption('advanced_edit', 0,'When starting a post, show advanced controls (0 or 1)','','writ');$err += LB_addOption('default_post_edit_rows', 9,'Size of the writing box (number of lines)','works','writ');$err += LB_addOption('use_smilies', 1,'Convert emoticons like :-) and :-P to graphics on display','works','writ');$err += LB_addOption('use_balanceTags', 1,'LassoBlogger should correct invalidly nested XHTML automatically','','writ');$err += LB_addOption('default_category', 1,'Default post category ID (must be number)','works','writ');$err += LB_addOption('new_users_can_blog', 0,'Newly registered members (0) cannot write articles, (1) may submit drafts for review, (2) may publish articles','works','writ');$err += LB_addOption('mailserver_url', 'mail.example.com','Writing by mail: mail server','works','writ');$err += LB_addOption('mailserver_port', 110,'Writing by mail: port number','works','writ');$err += LB_addOption('mailserver_login', 'myusername','Writing by mail: username for login','works','writ');$err += LB_addOption('mailserver_pass', 'mypassword','Writing by mail: password for login','works','writ');$err += LB_addOption('default_email_category', 1,'Writing by mail: default post category ID (number)','works','writ');$err += LB_addOption('ping_sites', 'http://rpc.pingomatic.com/','List of site update services to notify, when you write a new post (use line breaks to separate them)','','writ');// reading options// v0.8.0$err += LB_addOption('multiuser_blog', 0,'If set to 1, author names are displayed for each post, and author list is displayed in sidebar (0 or 1)','','read');$err += LB_addOption('posts_per_page', 10,'Max number shown on one page','works','read');$err += LB_addOption('what_to_show', 'posts','Max number is interpreted as meaning days (days) or posts (posts)','','read');$err += LB_addOption('posts_per_rss', 10,'RSS feeds: max number of posts shown','works','read');// new option, v0.9.0$err += LB_addOption('www_use_summary', 0,'Browser view: show summary instead of the whole content of posts (0 or 1)','works','read');$err += LB_addOption('rss_use_summary', 0,'RSS feeds: show summary instead of the whole content of posts (0 or 1)','works','read');$err += LB_addOption('blog_charset', 'ISO-8859-1','The character encoding you write your blog in','','writ');$err += LB_addOption('gzipcompression', 0,'LassoBlogger should compress articles (gzip) if browsers ask for them (0 or 1)','','read');// discussion options$err += LB_addOption('comment_registration', 0,'Users must be registered and logged in to comment (0 or 1); see Discussion Options for softer ways to control commenting','works','disc');$err += LB_addOption('default_pingback_flag', 1,'Attempt to notify any blogs linked to from the article (slows down posting) (0 or 1)','','misc');$err += LB_addOption('default_ping_status', '1','Allow link notifications from other blogs (pingbacks and trackbacks) (0 or 1)','','misc');$err += LB_addOption('default_comment_status', '1','Comments main switch (0 or 1)','works','disc');$err += LB_addOption('comments_notify', 2,'Send email when a comment has been submitted and NOT held for moderation (0 = no email, 1 = to writer of the post, 2 = to administrator) ','works','disc');$err += LB_addOption('moderation_notify', 2,'Send email when a comment is held for moderation (0 = no email, 1 = to writer of the post, 2 = to administrator)  ','works','disc');$err += LB_addOption('comment_moderation', 0,'Comments always go to moderation queue (i.e. they must be approved by administrator) regardless of any matches below (0 or 1)','works','disc');$err += LB_addOption('require_name_email', 1,'Comment author must fill out name and email (0 or 1)','works','disc');$err += LB_addOption('commentor_whitelist', 0,'Comment goes to moderation queue unless (1) the author is registered, or (2) the author is registered AND has a previously approved comment, (0, 1 or 2)','works','disc');$err += LB_addOption('comment_link_limit', 11,'If the comment contains links, (0) this option is ignored, (10) comment goes to moderation queue, (11) comment goes to moderation queue, unless the author is registered (12) comment goes to moderation queue, unless the author is registered AND has a previously accepted comment (20) comment is discarded, (21) comment is discarded, unless the author is registered (22) comment is discarded, unless the author is registered AND has a previously accepted comment','works','disc');$err += LB_addOption('moderation_keys',';','Comment always goes to moderation queue, if it contains any of these strings in its name, email, website, title, or content. Separate multiple strings with a semicolon (;) and optional space. Example: <code>friggin; holy-liftin</code>  ','works','disc');$err += LB_addOption('blacklist_keys',';','Comment is always discarded if it contains any of these strings in its name, email, website, title, or content. Separate multiple strings with a semicolon (;) and optional space. Example: <code>friggin; holy-liftin</code>. NOTE: Be careful: <code>ass</code> will trigger processing if the comment contains \"bass\" or \"assist\"','works','disc');$err += LB_addOption('open_proxy_check', 1,'Prevent comments from open and insecure proxies','','disc');// permalink options$err += LB_addOption('permalink_structure','','Use template tags to create a virtual site structure. <br>Currently permalinks are done with error.lasso method, and hence you should begin your entry with <code>.lasso</code> so that the file-not-found error is routed to Lasso. <br>Example (remember the dot): <code>.lasso/%year%/%monthnum%/%day%/%postname%</code> would result in <code>' + $pathToblog + '.lasso/2006/02/15/My_post</code>. Also available is the template tag <code>%postid%</code>','works','perm');$err += LB_addOption('category_base','','Custom prefix for your category URIs. For example <code>/taxonomy/categorias</code> would make your category links look like <code>' + (Server_Name) + '/taxonomy/categorias/uncategorized/</code>. Leave blank for default','','perm');// misc options    var('path') = response_path;    $path -> removeTrailing('admin/');$err += LB_addOption('use_fileupload', 0,'File upload main switch (0,1)','works','file');$err += LB_addOption('fileupload_path',($path + 'content'),'Destination directory, expressed relative to the domain root. Start with a slash (/). May very well be outside the blog directory','works','file');$err += LB_addOption('fileupload_maxk', 300,'Max size in kB','works','file');$err += LB_addOption('fileupload_allowedtypes', 'jpg jpeg gif png','Allowed file extensions. Remember to allow Lasso to process them (in Lasso Admin)','works','file');$err += LB_addOption('fileupload_minlevel', 6,'Minimum user level for file uploads (0...10)','works','file');$err += LB_addOption('use_linksupdate', 0,' Track Links&#8217; Update Times','','misc');$err += LB_addOption('hack_file', 0,'Use legacy file support','','misc');$err += LB_addOption('rss_excerpt_length', 50,'','','misc');$err += LB_addOption('links_updated_date_format', '','','','misc');$err += LB_addOption('links_recently_updated_prepend', '<em>','','','misc');$err += LB_addOption('links_recently_updated_append', '</em>','','','misc');$err += LB_addOption('links_recently_updated_time', 120,'','','misc');$err += LB_addOption('active_plugins','','','','misc');$err += LB_addOption('recently_edited','','','','misc');$err += LB_addOption('page_uris','','','','misc');$err += LB_addOption('rss_language', 'en','','','misc');$err += LB_addOption('html_type', 'text/html','','','misc');$err += LB_addOption('use_trackback', 0,'','','misc');// check for errorsif( $err );    $err;    loop_continue; // page aborted/if;// is there data in db already? (shouldn't be)    inline(-findall, $dbConfig, -table=$table_prefix + 'users');      if( found_count ); // ouch! there is data!        'An error occurred. You have probably ';        'already run this step. It cannot be run twice. ';        'If all else fails, you have to manually remove ';        'the database, and then run this installer again from the start.';            // otherwise the random password will be            // computed *again*, and will be wrong on screen        $abort = 'yes';      /if;    /inline;    if($abort); loop_continue; /if; // page abortedvar('SQL') = string;// Now drop in some default links$SQL += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'linkcategories (id, cat_name) VALUES (1, \'Blogroll\');';$SQL += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'links (lin_url, lin_name, lin_category, lin_rss) VALUES (\'http://blog.olympiahorseshow.com/\', \'Horse Show Blog built by Gary\', 1, \'http://blog.olympiahorseshow.com/feeds/?feed=rss2\');';// Default category$SQL += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'categories (ID, cat_name, cat_nicename) VALUES (\'0\', \'Uncategorized\', \'Uncategorized\');';// First post$SQL += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'posts (pos_author, pos_date, pos_date_gmt, pos_content, pos_title, pos_category, pos_name, pos_modified, pos_modified_gmt) VALUES (\'1\',\'' + $nowMySQL + '\', \'\', \'Welcome to LassoBlogger. This is your first post. Edit or delete it, then start blogging!\', \'Hello world!\', \'1\', \'hello-world\',\'' + $nowMySQL + '\', \'\');';$SQL += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'post2cat (id, p2c_post_id, p2c_category_id) VALUES (1, 1, 1);';// Default comment$SQL += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'comments (com_post_ID, com_author, com_author_email, com_author_url, com_author_IP, com_date, com_date_gmt, com_content) VALUES (\'1\', \'Mr LassoBlogger\', \'\', \'\', \'127.0.0.1\', \'' + $nowMySQL + '\', \'\', \'Hi, this is a comment.<br />To delete a comment, just log in, and view the admin page Manage > List Comments - there you will have the option to edit or delete comments.\');';// Default file category (for uploads)$SQL += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'uploadcats (ID, upc_name, upc_nicename, upc_description) VALUES (\'0\', \'General\', \'General\', \'My first file category\');';// Set up admin uservar('random_password') = string(Math_Random(-lower=100000,-upper=999999));$SQL += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'users (use_login, use_pass, use_nickname, use_email, use_level, use_idmode, use_registered) VALUES (\'admin\',\'' + encrypt_MD5($random_password) + '\', \'Administrator\', \'' + $admin_email + '\', \'10\', \'nickname\',\'' + $nowMySQL + '\' );';    // now write it all to db    inline($dbConfig,-SQL=$SQL);       if( error_msg != error_noerror );          '<p class="red">';          if( error_code == (1062) );              'Duplicate entry. You have probably already run this step.';          else;                 'Error in writing data. '; LO_errorMessage;              'You may want to fix something, then reload this page.';          /if;          '</p>';          $abort = 'yes';      /if;    /inline;    if($abort); loop_continue; /if; // page aborted// send email to the new adminvar('emailsubject') = 'From ' + $blog_title;var('emailbody') = 'Your new LassoBlogger blog has been successfully';$emailbody += ' set up. \n\n';$emailbody += 'You can log in to the administrator account with the following information:\n\n';$emailbody += 'Login address: ' + $pathToblog + 'admin/index.lasso\n';$emailbody += 'Username: admin\n';$emailbody += 'Password: ' + $random_password + '\n\n';$emailbody += 'We hope you enjoy your new blog. Thanks!\n\n';$emailbody += '--The LassoBlogger Team';email_send( -from=$admin_email,        -to=$admin_email,        -subject=$emailsubject,        -body=$emailbody);?><p>Now you can <a href="[$pathToblog]admin/index.lasso">log in</a> with the <strong>username</strong> "<code>admin</code>" and <strong>password</strong> "<code>[$random_password]</code>".</p><p><strong><em>Note that password</em></strong> carefully! It is a <em>random</em> password that was generated just for you. If you lose it, you will have to delete the database  yourself, and re-install LassoBlogger. So to review:</p><dl><dt>Username</dt><dd><code>admin</code></dd><dt>Password</dt><dd><code>[$random_password]</code></dd>        <dt>Login address</dt><dd><a href="index.lasso">admin/index.lasso</a></dd></dl><p><strong>One more thing:</strong> Ensure that your web server is configured so that when a directory is requested, it can show the file <code>index.lasso</code> as the index page. In Apache, this is done by adding <code>index.lasso</code> to the <code>DirectoryIndex</code> directive.  <p>That should be it! That's right, it's all done!</p><?LassoScript/If;            // end step 3/loop; // end loop to facilitate simulation of abort?>