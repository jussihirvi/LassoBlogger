<?LassoScript// list of tablesVariable:'aTables'=(Array:'categories','comments','linkcategories','links','options','post2cat','postmeta','posts','users','uploadcats','uploads');If: (Action_Param:'step') == '';	Variable:'step' = 0;	Else;	Variable:'step' = (Action_Param:'step');/If;// has this installer been run already?// begin checking    Include:'../inc/library.inc';     	// library is used in this file ONLY on the line below    If: $step == 0 && LB_getOption:'siteurl' != '';    '<strong>It seems that this installer has already been run.</strong> If this is not the case, or if you for some reason want to run it again, you have to manually remove (or bracket out) this checking code from the beginning of <code>admin/install_stuff.inc</code>.Or another possibility is to delete the database and then rerun this installer to recreate it.<br>';Abort;    /If;// end checkingIf: $step == 0;		// step 0// test inline	Inline:$dbConfig,	    -Table='testvalue',	    -FindAll;		Variable:'currentStatus' = '';		If: (Error_CurrentError) != (Error_NoError);		If: (Error_CurrentError:-ErrorCode) == '-3000';		$currentStatus = 'The database <b>' + $myDb + '</b> seems to exist. Doublecheck the permissions (if necessary), as directed below, and proceed with the first step. The first step is <b>slow</b>, so be patient!';		Else: (Error_CurrentError:-ErrorCode) == '-609';		$currentStatus = 'The database was not found. Follow the directions below to make it appear. You can reload this page to see the result. (Lasso returned the error code -609)';			Else;		'Error  '  + ': ';		(Error_CurrentError:-ErrorCode) + ', ' + 			(Error_CurrentError) + '<br>\r';		/If;	    /If;	/Inline;?><p>Welcome to LassoBlogger installer. We&#8217;re now going to go through a few steps to get you up and running with the best Lasso-based personal publishing platform (am I right?).</p><p>You are going to need access to Lasso's admin pages (in current Lasso versions: SiteAdmin) to get through this installation. If you haven't that access, please contact your Internet Service Provider and ask them to run this installer for you. </p> <p>Did you already review your <code>config.lasso</code> and fill in the necessary variables? If not, do that now! </p><p><strong>Current status: </strong>[$currentStatus]</p><p>Now, on Lasso's admin pages (SiteAdmin)<br> 	<strong>1. Create and enable the database</strong><br>	- databases are currently created in DatabaseBrowser.lassoapp, and enabled in SiteAdmin.lassoapp<br>	- the name must match the one that you stored in <code>config.lasso</code><br> 	<strong>2. Create the group and user</strong> (if they don't yet exist)<br>	- the user name and password must match the ones you stored in <code>config.lasso</code><br>	<strong>3. Assign privileges</strong><br>	- give your new group ALL rights to the new db ("all rights" means: Show Schema, Search, Add, Update, Delete, AND Execute Scripts)<br>	- also you must give your group the right to use SQL (in Lasso SiteAdmin, that privilege is assigned on the hosts level). Right to use SQL is currently (as of v0.8.0) <strong>only</strong> needed for the time of the install process <br>	</p>	<h2 class="step"><a href="install.lasso?step=1">Take the first 	step (create tables & fields)!</a></h2><?LassoScript //Else:$step == 1;		// end step 0, begin step 1// now tables will be created// the whole step 1 is wrapped in inline, to set the username & passwordInline:$dbConfig, -Nothing; 	Iterate:$aTables,(Var:'i');	Database_CreateTable:-Database=$myDb,-Table=($table_prefix + $i);	/Iterate;	// diffs to WordPress in tables: 	// here primary key in all table = ID, 	// not TablePrefix_idDefine_Tag:'LB_createField', 	-Required='table', 				-Required='name', 				-Required='type', 				-Required='default';    Database_CreateField:-Database=$myDb,	-Table= $table_prefix + #table,	-Field=#name,	-Type=#type,	-NotNull,	-Default=#default;	If: (Error_CurrentError) != (Error_NoError);	    Return: (Error_CurrentError);	    Else;	    Return:'';	/If;/Define_Tag;Variable:'err' = '';// *** table: categories ***	// diffs to WordPress: 	// all fnames in WP had prefix category_, here always cat_$err += (LB_CreateField:'categories','cat_name','VARCHAR(55)','');$err += (LB_CreateField:'categories','cat_nicename','VARCHAR(200)','');$err += (LB_CreateField:'categories','cat_description','TEXT','');$err += (LB_CreateField:'categories','cat_parent','INT(4)','0');$err += (LB_CreateField:'categories','cat_sortorder','VARCHAR(255)','descending');// *** table: comments *** // 	 // fieldName prefix in WP "comment_", here "com_"$err += (LB_CreateField:'comments','com_post_ID','INT(11)','0');$err += (LB_CreateField:'comments','com_author','TINYTEXT','');$err += (LB_CreateField:'comments','com_author_email','VARCHAR(100)','');$err += (LB_CreateField:'comments','com_author_url','VARCHAR(200)','');$err += (LB_CreateField:'comments','com_author_IP','VARCHAR(100)','');$err += (LB_CreateField:'comments','com_date','DATETIME','0000-00-00 00:00:00');$err += (LB_CreateField:'comments','com_date_gmt','DATETIME','0000-00-00 00:00:00');// WordPress does not have this field$err += (LB_CreateField:'comments','com_title','VARCHAR(255)','');$err += (LB_CreateField:'comments','com_content','TEXT','');$err += (LB_CreateField:'comments','com_karma','INT(11)','0');$err += (LB_CreateField:'comments','com_approved','ENUM(\'0\',\'1\',\'spam\')','1');$err += (LB_CreateField:'comments','com_agent','VARCHAR(255)','');$err += (LB_CreateField:'comments','com_type','VARCHAR(20)','');$err += (LB_CreateField:'comments','com_parent','INT(11)','0');$err += (LB_CreateField:'comments','com_user_id','INT(11)','0');// *** table: linkcategories *** //$err += (LB_CreateField:'linkcategories','cat_name','TINYTEXT','');$err += (LB_CreateField:'linkcategories','auto_toggle','ENUM(\'Y\',\'N\')','N');$err += (LB_CreateField:'linkcategories','show_images','ENUM(\'Y\',\'N\')','Y');$err += (LB_CreateField:'linkcategories','show_description','ENUM(\'Y\',\'N\')','N');$err += (LB_CreateField:'linkcategories','show_rating','ENUM(\'Y\',\'N\')','Y');$err += (LB_CreateField:'linkcategories','show_updated','ENUM(\'Y\',\'N\')','Y');$err += (LB_CreateField:'linkcategories','sort_order','VARCHAR(64)','rand');$err += (LB_CreateField:'linkcategories','sort_desc','ENUM(\'Y\',\'N\')','N');$err += (LB_CreateField:'linkcategories','text_before_link','VARCHAR(128)','<li>');$err += (LB_CreateField:'linkcategories','text_after_link','VARCHAR(128)','<br />');$err += (LB_CreateField:'linkcategories','text_after_all','VARCHAR(128)','</li>');$err += (LB_CreateField:'linkcategories','list_limit','INT(11)','-1');// *** table: links *** //	// diffs to WordPress: 	// all fnames in WP had prefic link_, here always lin_$err += (LB_CreateField:'links','lin_url','VARCHAR(255)','');$err += (LB_CreateField:'links','lin_name','VARCHAR(255)','');$err += (LB_CreateField:'links','lin_image','VARCHAR(255)','');$err += (LB_CreateField:'links','lin_target','VARCHAR(25)','');$err += (LB_CreateField:'links','lin_category','INT(11)','0');$err += (LB_CreateField:'links','lin_description','VARCHAR(255)','');$err += (LB_CreateField:'links','lin_visible','ENUM(\'Y\',\'N\')','Y');$err += (LB_CreateField:'links','lin_owner','INT(11)','1');$err += (LB_CreateField:'links','lin_rating','INT(11)','0');$err += (LB_CreateField:'links','lin_updated','DATETIME','0000-00-00 00:00:00');$err += (LB_CreateField:'links','lin_rel','VARCHAR(255)','');$err += (LB_CreateField:'links','lin_notes','TEXT','');	 // in WP, MEDIUMTEXT$err += (LB_CreateField:'links','lin_rss','VARCHAR(255)','');//   KEY link_category (link_category),//   KEY link_visible (link_visible)// *** table: options *** //	// diffs to WordPress: 	// all fnames in WP had prefic options_, here always opt_$err += (LB_CreateField:'options','opt_blog_id','INT(11)','0'); 			// in v050829 was: blog_id$err += (LB_CreateField:'options','opt_name','VARCHAR(64)','');$err += (LB_CreateField:'options','opt_can_override','ENUM(\'Y\',\'N\')','Y');$err += (LB_CreateField:'options','opt_type','INT(11)','1');$err += (LB_CreateField:'options','opt_value','varchar(255)','');	// in WP, opt_value type was "longtext"$err += (LB_CreateField:'options','opt_width','INT(11)','20');$err += (LB_CreateField:'options','opt_height','INT(11)','8');$err += (LB_CreateField:'options','opt_description','TEXT',''); 			// in WP was: TINYTEXT$err += (LB_CreateField:'options','opt_status','VARCHAR(255)',''); 			// not in WP$err += (LB_CreateField:'options','opt_admin_level','INT(11)','1');$err += (LB_CreateField:'options','opt_autoload','ENUM(\'yes\',\'no\')','yes');	// in WP, without prefix: "autoload"$err += (LB_CreateField:'options','opt_group','ENUM(\'gene\',\'writ\',\'read\',\'disc\',\'perm\',\'file\',\'misc\')','gene');	// v0.8.0$err += (LB_CreateField:'options','opt_sortcode','VARCHAR(255)','');	// v0.8.0//  PRIMARY KEY  (option_id,blog_id,option_name),//  KEY option_name (option_name)// tuo on huttua??// *** table: post2cat *** //	// diffs to WordPress: 	// fnames in WP had mixed prefixes, here always p2c_	// primary index field was "rel_id"$err += (LB_CreateField:'post2cat','p2c_post_id','BIGINT(20)','0');$err += (LB_CreateField:'post2cat','p2c_category_id','BIGINT(20)','0');//  KEY post_id (post_id,category_id)// *** table: postmeta *** //	// diffs to WordPress: 	// most fnames in WP had prefic meta_, here always met_$err += (LB_CreateField:'postmeta','met_post_id','BIGINT(20)','0');$err += (LB_CreateField:'postmeta','met_key','VARCHAR(255)','');			// in WP, this was the 1st null field in this 		// solution; i wonder is there a reason??$err += (LB_CreateField:'postmeta','met_value','TEXT','');//   KEY post_id (post_id),//   KEY meta_key (meta_key)// *** table: posts *** //	// diffs to WordPress: 	// most fnames in WP had prefix post_, here always pos_$err += (LB_CreateField:'posts','pos_author','INT(4)','0');$err += (LB_CreateField:'posts','pos_date','DATETIME','0000-00-00 00:00:00');$err += (LB_CreateField:'posts','pos_date_gmt','DATETIME','0000-00-00 00:00:00');$err += (LB_CreateField:'posts','pos_content','LONGTEXT','');	// in 0.5.0 was TEXT (=max 64k instead of 24M)$err += (LB_CreateField:'posts','pos_title','TEXT','');$err += (LB_CreateField:'posts','pos_category','INT(4)','0');$err += (LB_CreateField:'posts','pos_excerpt','TEXT','');$err += (LB_CreateField:'posts','pos_status','ENUM(\'publish\',\'draft\',\'private\',\'static\',\'object\')','publish');$err += (LB_CreateField:'posts','pos_comment_status','ENUM(\'open\',\'closed\',\'registered_only\')','open');$err += (LB_CreateField:'posts','pos_ping_status','ENUM(\'open\',\'closed\')','open');$err += (LB_CreateField:'posts','pos_password','VARCHAR(20)','');$err += (LB_CreateField:'posts','pos_name','VARCHAR(200)','');$err += (LB_CreateField:'posts','pos_to_ping','TEXT','');$err += (LB_CreateField:'posts','pos_pinged','text','');$err += (LB_CreateField:'posts','pos_modified','DATETIME','0000-00-00 00:00:00');$err += (LB_CreateField:'posts','pos_modified_gmt','DATETIME','0000-00-00 00:00:00');$err += (LB_CreateField:'posts','pos_content_filtered','TEXT','');$err += (LB_CreateField:'posts','pos_parent','INT(11)','0');$err += (LB_CreateField:'posts','pos_guid','VARCHAR(255)','');$err += (LB_CreateField:'posts','pos_menu_order','INT(11)','0');//   KEY post_name (post_name)// *** table: users *** //	// diffs to WordPress: 	// all fnames in WP had prefix user_, here always use_$err += (LB_CreateField:'users','use_login','VARCHAR(60)','');$err += (LB_CreateField:'users','use_pass','VARCHAR(64)','');$err += (LB_CreateField:'users','use_firstname','VARCHAR(50)','');$err += (LB_CreateField:'users','use_lastname','VARCHAR(50)','');$err += (LB_CreateField:'users','use_nickname','VARCHAR(50)','');$err += (LB_CreateField:'users','use_nicename','VARCHAR(50)','');$err += (LB_CreateField:'users','use_icq','INT(10)','0');	// in WP, unsigned$err += (LB_CreateField:'users','use_email','VARCHAR(100)','');$err += (LB_CreateField:'users','use_url','VARCHAR(100)','');$err += (LB_CreateField:'users','use_ip','VARCHAR(15)','');$err += (LB_CreateField:'users','use_domain','VARCHAR(200)','');$err += (LB_CreateField:'users','use_browser','VARCHAR(200)','');$err += (LB_CreateField:'users','use_registered','DATETIME','0000-00-00 00:00:00');$err += (LB_CreateField:'users','use_level','INT(4)','0');	// in WP, INT(2), unsigned$err += (LB_CreateField:'users','use_aim','VARCHAR(50)','');$err += (LB_CreateField:'users','use_msn','VARCHAR(100)','');$err += (LB_CreateField:'users','use_yim','VARCHAR(50)','');$err += (LB_CreateField:'users','use_idmode','VARCHAR(20)','');$err += (LB_CreateField:'users','use_activation_key','VARCHAR(60)','');$err += (LB_CreateField:'users','use_status','INT(11)','0');$err += (LB_CreateField:'users','use_description','TEXT','');	// in WP, LONGTEXT// *** table: uploadcats *** //	// not in WordPress: $err += (LB_CreateField:'uploadcats','upc_name','VARCHAR(55)','');$err += (LB_CreateField:'uploadcats','upc_nicename','VARCHAR(200)','');$err += (LB_CreateField:'uploadcats','upc_description','LONGTEXT','');$err += (LB_CreateField:'uploadcats','upc_parent','INT(5)','');$err += (LB_CreateField:'uploadcats','upc_sortorder','VARCHAR(255)','descending');// *** table: uploads *** //	// not in WordPress: $err += (LB_CreateField:'uploads','upl_catid','INT(4)','');$err += (LB_CreateField:'uploads','upl_postid','BIGINT(20)','');$err += (LB_CreateField:'uploads','upl_name','VARCHAR(60)','');$err += (LB_CreateField:'uploads','upl_path','VARCHAR(255)','');$err += (LB_CreateField:'uploads','upl_description','VARCHAR(255)','');$err += (LB_CreateField:'uploads','upl_customsortcode','VARCHAR(255)','');$err += (LB_CreateField:'uploads','upl_created','DATETIME','');$err += (LB_CreateField:'uploads','upl_modified','DATETIME','');$err += (LB_CreateField:'uploads','upl_userid','INT(4)','');$err += (LB_CreateField:'uploads','upl_imagedisplay','ENUM(\'right\',\'left\',\'block\',\'link\',\'none\')','');$err += (LB_CreateField:'uploads','upl_linkurl','VARCHAR(255)','');// from wp installer: // "UNIQUE KEY user_login (user_login)"	    // error handler for step 1	    Variable:'temp_errorFlag' = '';	If: (Error_CurrentError) != (Error_NoError);	'An error occurred in step 1: ';	    If: (Error_CurrentError:-ErrorCode) == '-9961';	    'You don\'t have permission for the action. <strong>Please go back and verify that you have assigned the user permissions as specified</strong>. (Error code was -9961.)<br>'; 	    Else;	    (Error_CurrentError:-ErrorCode) + ', ' + 		    (Error_CurrentError) + '<br>';	    /If;	'You are free to try step 2, if you think the table structure is ready in spite of this error message.<br>';	Variable:'temp_errorFlag' = 'err';	/If;/Inline;// create indexesVariable:'SQL_string'='';$SQL_string = 'ALTER TABLE ' + $table_prefix + 'categories ADD INDEX cat_nicename (cat_nicename);ALTER TABLE '+$table_prefix+'comments ADD INDEX com_approved (com_approved);ALTER TABLE '+$table_prefix+'comments ADD INDEX com_post_ID (com_post_ID);ALTER TABLE '+$table_prefix+'links ADD INDEX lin_category (lin_category);ALTER TABLE '+$table_prefix+'links ADD INDEX lin_visible (lin_visible);ALTER TABLE '+$table_prefix+'options ADD INDEX opt_name (opt_name);ALTER TABLE '+$table_prefix+'post2cat ADD INDEX p2c_post_id (p2c_post_id,p2c_category_id);ALTER TABLE '+$table_prefix+'postmeta ADD INDEX met_post_id (met_post_id);ALTER TABLE '+$table_prefix+'postmeta ADD INDEX met_key (met_key);ALTER TABLE '+$table_prefix+'posts ADD INDEX pos_name (pos_name);ALTER TABLE '+$table_prefix+'posts ADD FULLTEXT pos_title (pos_title);ALTER TABLE '+$table_prefix+'posts ADD FULLTEXT pos_excerpt (pos_excerpt);ALTER TABLE '+$table_prefix+'posts ADD FULLTEXT pos_content (pos_content);ALTER TABLE '+$table_prefix+'posts ADD FULLTEXT pos_combined (pos_title, pos_excerpt, pos_content);ALTER TABLE '+$table_prefix+'users ADD INDEX use_login (use_login);ALTER TABLE '+$table_prefix+'uploadcats ADD INDEX upc_nicename (upc_nicename);ALTER TABLE '+$table_prefix+'uploads ADD INDEX upl_postid (upl_postid);ALTER TABLE '+$table_prefix+'uploads ADD INDEX upl_name (upl_name);ALTER TABLE '+$table_prefix+'uploads ADD INDEX upl_customsortcode (upl_customsortcode);';// do it	    Inline:$dbConfig, -SQL=$SQL_string;			    If: (Error_CurrentError) != (Error_NoError);		    'Error in creating indexes: ';		    (Error_CurrentError:-ErrorCode) + ', ' + 			    (Error_CurrentError) + '<br>\r';			    $temp_errorFlag = 'err';		/If;	    /Inline;// the next is to make lasso refresh the security cache// any action will do, if it only refers to some of the new tables (or any nonexistent table?) If: $temp_errorFlag == '';    Inline:$dbConfig, -Table=$table_prefix + 'options',-Show;    /Inline;/If; ?><p>[If: $temp_errorFlag == '']Good. The tables have been created. Now [Else]After the tables are created, [/If]you must do the following:<br><strong>1. Give your user group ALL rights to ALL the new tables</strong> (and don't forget that there are more tables than ten!)<br>- on Lasso's SiteAdmin pages, you might have to press the Refresh button first to make the new tables appear<br></p>	<h2 class="step"><a href="install.lasso?step=2">Take the second step (optimize & analyze tables)!</h2><?LassoScriptElse: $step == 2; 		// end step 1, begin step 2// analyze & optimize seems to succeed ok even when the user// hasn't yet given all table rights (050830)Variable:'temp_errorFlag' = '';// *** optimize tables ***	Variable:'SQL_string'=(String);	Iterate:$aTables,(Var:'i');		$SQL_string = 'OPTIMIZE TABLE ' + $myDb + '.' 		    + $table_prefix + $i;		Inline:$dbConfig,		    -SQL=$SQL_string;				If: (Error_CurrentError) != (Error_NoError);			'Error in optimize, table ' + $table_prefix + $i + ': ';			(Error_CurrentError:-ErrorCode) + ', ' + 				(Error_CurrentError) + '<br>\r';				$temp_errorFlag = 'err';		    /If;		/Inline;	/Iterate;// *** analyze tables ***	Variable:'SQL_string'=(String);	Iterate:$aTables,(Var:'i');		$SQL_string = 'ANALYZE TABLE ' + $myDb + '.' 		    + $table_prefix + $i;		Inline:$dbConfig,		    -SQL=$SQL_string;				If: (Error_CurrentError) != (Error_NoError);			'Error in analyze, table ' + $i + ': ';			(Error_CurrentError:-ErrorCode) + ', ' + 				(Error_CurrentError) + '<br>\r';				$temp_errorFlag = 'err';		    /If;		/Inline;	/Iterate;?>[If: $temp_errorFlag == 'err']<p>Some errors were detected. You should check what they are about (the developers will be interested to hear about this!) If you think everything is ok, please continue: fill in the form below and take the next step.</p>[Else]<p>That went probably very fast. No errors were detected. Next you should fill in the form below and submit it.</p>[/If] <form id="setup" method="post" action="install.lasso?step=3"><table width="100%"><tr><th width="33%">Blog title:</th><td><input type="hidden" name="-required"><input name="blog_title" type="text" id="blog_title" size="25" /></td></tr><tr><td>&nbsp;</td><td><em>You can always change it later</em></td></tr><tr><th>Your e-mail:</th><td><input type="hidden" name="-required"><input name="admin_email" type="text" id="admin_email" size="25" /></td></tr><tr><td>&nbsp;</td><td><em>Double-check that email address before continuing</em></td></tr></table><h2 class="step"><input type="submit" name="Submit" value="Take the third step" /></h2></form><?LassoScript //Else:$step == 3;		// end step 2, begin step 3/* now the db, tables, and fields are ready. Now we process form data,create sample data,and give the user his admin username:password?first: check that there are some permissions given to tables:*/Inline:-Show,$dbConfig,-Table=$table_prefix+'posts';    If: (Error_CurrentError:-ErrorCode) == '-9961';       'An error occurred.<br>';       'The table privileges were tested using the "';       $table_prefix; 'posts" table and "show" action as an example.';       'It seems there are not enough privileges. This is something you\'d ' +       	 'better correct before continuing.<br>';	'Then you can try to reload this page.';       Abort;   Else: (Error_CurrentError) != (Error_NoError);       'An error occurred.<br>';       'More info: ' + (Error_CurrentError:-ErrorCode);       ', ' + (Error_CurrentError) + '<br>';       Abort;   Else; 				// there was no error   /If;/Inline;// capture form data (they will be written to db etc.)Variable:'blog_title' = (Action_Param:'blog_title'),	'admin_email' = (Action_Param:'admin_email');// we can add email validation routine in later version// we can add  basic text validation routine in later version// this will be the path to front page    Variable:'pathToblog' = $pathTome;    $pathToblog -> (RemoveTrailing:'admin/');//  * DEFAULT OPTIONS taken from WordPress // options will be added with a ctag Define_Tag: 'LB_addOption', 	-Required='optionName',    				-Required='optionValue',				-Required='optionDescription',				-Optional='optionStatus',				-Optional='optionGroup';	Local:'error' = '';	If: Params -> Size > 3;	    Local: 'optionStatus' = (Params) -> (Get:4);	    Else;	    Local: 'optionStatus' = '';	/If;	If: Params -> Size > 4;	    Local: 'optionGroup' = (Params) -> (Get:5);	    Else;	    Local: 'optionGroup' = 'misc';	/If;	Inline:-Add,$dbConfig,	    -Table=$table_prefix + 'options',	    'opt_name'=#optionName,	    'opt_value'=#optionValue,	    'opt_description'=#optionDescription,	    'opt_status' = #optionStatus,	    'opt_group' = #optionGroup;	    If: (Error_CurrentError) != (Error_NoError);	       #error = 'An error occurred while trying to add the option ';	       #error += #optionName + ' to the "' + $table_prefix + 'options" table.<br>';	       #error += 'More info: ' + (Error_CurrentError:-ErrorCode);	       #error += ', ' + (Error_CurrentError) + '<br>&nbsp;<br>';	    /If;	/Inline;	Output: #error;/Define_Tag;Variable:'err' = '';$err += (LB_addOption:'siteurl',$pathtoBlog,'Where your blog can be found on the net','works','gene');    If: $err != '';	$err;  // the ctag has returned an error - show it, and abort	Abort;    /If;$err += (LB_addOption:'blogname',$blog_title,'The title of your blog','works','gene');$err += (LB_addOption:'admin_email',$admin_email,'This is important','works','gene');$err += (LB_addOption:'blogdescription','Just another blog','In a few words, explain what your blog is about','works','gene');	$err += (LB_addOption:'users_can_register', 0, 'Anyone can register (0 or1)','works','gene');	$err += (LB_addOption:'comment_registration', 0,'Users must be registered and logged in to comment (0 or 1); see Discussion Options for softer ways to control commenting','works','disc');	$err += (LB_addOption:'gmt_offset', 0,'Times in the weblog should differ by (number of hours)','','gene');	$err += (LB_addOption:'date_format','%m/%d/%Y','If not the standard format. Consult Lasso\'s Date_Format tag. Example:<code>%d.%m.%Y</code>','works','gene');	$err += (LB_addOption:'time_format','%H:%M:%S','If not the standard format. Example: <code>%h:%M %p</code>','works','gene');	$err += (LB_addOption:'home','','If you want your blog homepage to be different than the directory you installed LassoBlogger in, enter that address here','','home');	$err += (LB_addOption:'start_of_week', 1,'0 for sunday, 1 for monday etc.','','gene');// writing options 	$err += (LB_addOption:'advanced_edit', 0,'When starting a post, show advanced controls (0 or 1)','','writ');	$err += (LB_addOption:'default_post_edit_rows', 9,'Size of the writing box (number of lines)','works','writ');	$err += (LB_addOption:'use_smilies', 1,'Convert emoticons like :-) and :-P to graphics on display','works','writ');	$err += (LB_addOption:'use_balanceTags', 1,'LassoBlogger should correct invalidly nested XHTML automatically','','writ');	$err += (LB_addOption:'default_category', 1,'Default post category ID (must be number)','works','writ');	$err += (LB_addOption:'new_users_can_blog', 0,'Newly registered members (0) cannot write articles, (1) may submit drafts for review, (2) may publish articles','works','writ');	$err += (LB_addOption:'mailserver_url', 'mail.example.com','Writing by mail: mail server','works','writ');	$err += (LB_addOption:'mailserver_port', 110,'Writing by mail: port number','works','writ');	$err += (LB_addOption:'mailserver_login', 'myusername','Writing by mail: username for login','works','writ');	$err += (LB_addOption:'mailserver_pass', 'mypassword','Writing by mail: password for login','works','writ');	$err += (LB_addOption:'default_email_category', 1,'Writing by mail: default post category ID (number)','works','writ');	$err += (LB_addOption:'ping_sites', 'http://rpc.pingomatic.com/','List of site update services to notify, when you write a new post (use line breaks to separate them)','','writ');// reading options	// v0.8.0	$err += (LB_addOption:'multiuser_blog', 0,'If set to 1, author names are displayed for each post, and author list is displayed in sidebar (0 or 1)','','read');	$err += (LB_addOption:'posts_per_page', 10,'Max number shown on one page','works','read');	$err += (LB_addOption:'what_to_show', 'posts','Max number is interpreted as meaning days (days) or posts (posts)','','read');	$err += (LB_addOption:'posts_per_rss', 10,'RSS feeds: max number of posts shown','works','read');	// new option, v0.9.0	$err += (LB_addOption:'www_use_summary', 0,'Browser view: show summary instead of the whole content of posts (0 or 1)','works','read');	$err += (LB_addOption:'rss_use_summary', 0,'RSS feeds: show summary instead of the whole content of posts (0 or 1)','works','read');	$err += (LB_addOption:'blog_charset', 'ISO-8859-1','The character encoding you write your blog in','','writ');	$err += (LB_addOption:'gzipcompression', 0,'LassoBlogger should compress articles (gzip) if browsers ask for them (0 or 1)','','read');// discussion options	$err += (LB_addOption:'default_pingback_flag', 1,'Attempt to notify any blogs linked to from the article (slows down posting) (0 or 1)','','misc');	$err += (LB_addOption:'default_ping_status', '1','Allow link notifications from other blogs (pingbacks and trackbacks) (0 or 1)','','misc');	$err += (LB_addOption:'default_comment_status', '1','Comments main switch (0 or 1)','works','disc');	$err += (LB_addOption:'comments_notify', 2,'Send email when a comment has been submitted and NOT held for moderation (0 = no email, 1 = to writer of the post, 2 = to administrator) ','works','disc');	$err += (LB_addOption:'moderation_notify', 2,'Send email when a comment is held for moderation (0 = no email, 1 = to writer of the post, 2 = to administrator)  ','works','disc');	$err += (LB_addOption:'comment_moderation', 0,'Comments always go to moderation queue (i.e. they must be approved by administrator) regardless of any matches below (0 or 1)','works','disc');	$err += (LB_addOption:'require_name_email', 1,'Comment author must fill out name and email (0 or 1)','works','disc');	$err += (LB_addOption:'commentor_whitelist', 0,'Comment goes to moderation queue unless (1) the author is registered, or (2) the author is registered AND has a previously approved comment, (0, 1 or 2)','works','disc');	$err += (LB_addOption:'comment_link_limit', 11,'If the comment contains links, (0) this option is ignored, (10) comment goes to moderation queue, (11) comment goes to moderation queue, unless the author is registered (12) comment goes to moderation queue, unless the author is registered AND has a previously accepted comment (20) comment is discarded, (21) comment is discarded, unless the author is registered (22) comment is discarded, unless the author is registered AND has a previously accepted comment','works','disc');	$err += (LB_addOption:'moderation_keys',';','Comment always goes to moderation queue, if it contains any of these strings in its name, email, website, title, or content. Separate multiple strings with a semicolon (;) and optional space. Example: <code>friggin; holy-liftin</code>  ','works','disc');	$err += (LB_addOption:'blacklist_keys',';','Comment is always discarded if it contains any of these strings in its name, email, website, title, or content. Separate multiple strings with a semicolon (;) and optional space. Example: <code>friggin; holy-liftin</code>. NOTE: Be careful: <code>ass</code> will trigger processing if the comment contains \"bass\" or \"assist\"','works','disc');	$err += (LB_addOption:'open_proxy_check', 1,'Prevent comments from open and insecure proxies','','disc');// permalink options	$err += (LB_addOption:'permalink_structure','','Use template tags to create a virtual site structure. <br>Currently permalinks are done with error.lasso method, and hence you should begin your entry with <code>.lasso</code> so that the file-not-found error is routed to Lasso. <br>Example (remember the dot): <code>.lasso/%year%/%monthnum%/%day%/%postname%</code> would result in <code>' + $pathToblog + '.lasso/2006/02/15/My_post</code>. Also available is the template tag <code>%postid%</code>','works','perm');	$err += (LB_addOption:'category_base','','Custom prefix for your category URIs. For example <code>/taxonomy/categorias</code> would make your category links look like <code>' + (Server_Name) + '/taxonomy/categorias/uncategorized/</code>. Leave blank for default','','perm');// misc options	    Variable:'path' = (response_path);	    $path -> (RemoveTrailing:'admin/');	$err += (LB_addOption:'use_fileupload', 0,'File upload main switch (0,1)','works','file');	$err += (LB_addOption:'fileupload_realpath',($path + 'content'),'Destination directory, expressed relative to the domain root. Start with a slash (/). May very well be outside the blog directory','works','file');	$err += (LB_addOption:'fileupload_url', $pathtoBlog + 'content','URI of this directory','works','file');	$err += (LB_addOption:'fileupload_maxk', 300,'Max size in kB','works','file');	$err += (LB_addOption:'fileupload_allowedtypes', 'jpg jpeg gif png','Allowed file extensions. Remember to allow Lasso to process them (in Lasso Admin)','works','file');	$err += (LB_addOption:'fileupload_minlevel', 6,'Minimum user level for file uploads (0...10)','works','file');	$err += (LB_addOption:'use_linksupdate', 0,' Track Links&#8217; Update Times','','misc');	$err += (LB_addOption:'hack_file', 0,'Use legacy file support','','misc');// not visible on WP admin comment pages	$err += (LB_addOption:'rss_excerpt_length', 50,'','','misc');	$err += (LB_addOption:'links_updated_date_format', '','','','misc');	$err += (LB_addOption:'links_recently_updated_prepend', '<em>','','','misc');	$err += (LB_addOption:'links_recently_updated_append', '</em>','','','misc');	$err += (LB_addOption:'links_recently_updated_time', 120,'','','misc');	$err += (LB_addOption:'active_plugins','','','','misc');	// WP 1.5	$err += (LB_addOption:'recently_edited','','','','misc');	$err += (LB_addOption:'template', 'default','','','misc');	$err += (LB_addOption:'stylesheet', 'default','','','misc');	$err += (LB_addOption:'page_uris','','','','misc');	$err += (LB_addOption:'rss_language', 'en','','','misc');	$err += (LB_addOption:'html_type', 'text/html','','','misc');	// 1.5.1	$err += (LB_addOption:'use_trackback', 0,'','','misc');// END DEFAULT OPTIONS OF WordPress// check for errorsIf: $err != '';    $err;    Abort;/If;// is there data in db already? (shouldn't be)    Inline:-FindAll, $dbConfig,	-Table=$table_prefix + 'users';	    If: (Found_Count) > 0; // ouch! there is data!	    'An error occurred. You have probably ';	    'already run this step. It cannot be run twice. ';	    'If all else fails, you have to manually remove ';	    'the database, and then run this installer again from the start.';		// otherwise the random password will be		// computed *again*, and will be wrong on screen	    Abort;	    /If;    /Inline;Variable:'SQL_string' = (String);// DEFAULT DATA from WordPress BEGINS// Now drop in some default links$SQL_string += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'linkcategories (id, cat_name) VALUES (1, \'Blogroll\');';$SQL_string += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'links (lin_url, lin_name, lin_category, lin_rss) VALUES (\'http://blog.olympiahorseshow.com/\', \'Horse Show Blog built by Gary\', 1, \'http://blog.olympiahorseshow.com/feeds/?feed=rss2\');';// Default category$SQL_string += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'categories (ID, cat_name, cat_nicename) VALUES (\'0\', \'Uncategorized\', \'Uncategorized\');';// First post$SQL_string += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'posts (pos_author, pos_date, pos_date_gmt, pos_content, pos_title, pos_category, pos_name, pos_modified, pos_modified_gmt) VALUES (\'1\',\'' + $nowMySQL + '\', \'\', \'Welcome to LassoBlogger. This is your first post. Edit or delete it, then start blogging!\', \'Hello world!\', \'1\', \'hello-world\',\'' + $nowMySQL + '\', \'\');';$SQL_string += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'post2cat (id, p2c_post_id, p2c_category_id) VALUES (1, 1, 1);';// Default comment$SQL_string += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'comments (com_post_ID, com_author, com_author_email, com_author_url, com_author_IP, com_date, com_date_gmt, com_content) VALUES (\'1\', \'Mr LassoBlogger\', \'\', \'\', \'127.0.0.1\', \'' + $nowMySQL + '\', \'\', \'Hi, this is a comment.<br />To delete a comment, just log in, and view the admin page Manage > List Comments - there you will have the option to edit or delete comments.\');';// Default file category (for uploads)$SQL_string += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'uploadcats (ID, upc_name, upc_nicename, upc_description) VALUES (\'0\', \'General\', \'General\', \'My first file category\');';// Set up admin userVariable:'random_password' = (Math_Random:-Min=100000,-Max=999999);$SQL_string += 'INSERT INTO ' + $myDb + '.' + $table_prefix + 'users (ID, use_login, use_pass, use_nickname, use_email, use_level, use_idmode, use_registered) VALUES ( \'1\', \'admin\',\'' + (Encrypt_MD5:$random_password) + '\', \'Administrator\', \'' + $admin_email + '\', \'10\', \'nickname\',\'' + $nowMySQL + '\' );';// END DEFAULT DATA FROM WordPress    // now write it all to db	    Inline:$dbConfig,-SQL=$SQL_string;			    If: (Error_CurrentError) != (Error_NoError);			'<b>';			If: (Error_CurrentError:-ErrorCode) =='1062';			    'Duplicate entry. You have probably already run ';			    'this step.';			Else;				    'Error in writing data. ';			    (Error_CurrentError:-ErrorCode) + ', ' + 				    (Error_CurrentError);			    '. You may want to fix something, then ';			    'reload this page.';			/If;			'</b>';			Abort;		    /If;	    /Inline;// send email to the new adminVariable:'emailsubject' = 'From ' + $blog_title;Variable:'emailbody' = 'Your new LassoBlogger blog has been successfully';$emailbody += ' set up. \n\n';$emailbody += 'You can log in to the administrator account with the following information:\n\n';$emailbody += 'Login address: ' + $pathToblog + 'admin/index.lasso\n';$emailbody += 'Username: admin\n';$emailbody += 'Password: ' + $random_password + '\n\n';$emailbody += 'We hope you enjoy your new blog. Thanks!\n\n';$emailbody += '--The LassoBlogger Team';Email_Send: -From=$admin_email,	-To=$admin_email,	-Subject=$emailsubject,	-Body=$emailbody;?><p>Now you can <a href="[$pathToblog]admin/index.lasso">log in</a> with the <strong>username</strong> "<code>admin</code>" and <strong>password</strong> "<code>[$random_password]</code>".</p><p><strong><em>Note that password</em></strong> carefully! It is a <em>random</em> password that was generated just for you. If you lose it, you will have to delete the database  yourself, and re-install LassoBlogger. So to review:</p><dl><dt>Username</dt><dd><code>admin</code></dd><dt>Password</dt><dd><code>[$random_password]</code></dd>	<dt>Login address</dt><dd><a href="index.lasso">admin/index.lasso</a></dd></dl><p><strong>One more thing:</strong> Ensure that your web server is configured so that when a directory is requested, it can show the file <code>index.lasso</code> as the index page. In Apache, this is done by adding <code>index.lasso</code> to the <code>DirectoryIndex</code> directive.  <p>That should be it! That's right, it's all done!</p><?LassoScript/If; 		// end step 3?>