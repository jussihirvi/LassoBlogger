<div class="center"><?LassoScript //>// key to stub file searchfields & editfields arrays: // 10 = for searchform, opt.: no linebreak after field (nobreak)// 11 = for searchform, opt.: opeator (eq, cn etc.)// 12 = opt.: encrypt (md5)// 'test: '; action_params; '<br>';Variable:'action' = '';    If: !(Variable_Defined:'uploadForm');	Variable:'uploadForm' = (Action_Param:'uploadForm'); // see stub file    /If;    If: !(Variable_Defined:'emptyForm');	Variable:'emptyForm' = (Action_Param:'emptyForm'); // see stub file    /If;    If: !(Variable_Defined:'formTargetpage'); // see stub file    Variable:'formTargetpage' = $myfilename;    /If;    If: !(Variable_Defined:'allowFileupload'); // see stub file    Variable:'allowFileupload' = '';    /If;Variable:'keyvalue'=(Action_Param:'keyvalue');Variable:'skip'=(Action_Param:'skip');Variable:'search'=(Action_Param:'search');Variable:'hakuinlinestuff'=(Array);Variable:'linkstuff'='';Variable:'formstuff'='';Variable:'searchToggle'='';Variable:'dbChange'=integer;Variable:'dbChange_error'='';Variable:'reqFieldsFound'='';Variable:'date_showFormat' = 	($basicOptions -> 'date_format') + ' ' + 	($basicOptions -> 'time_format');Variable:'fieldCounter' = 0; // dbChange action flagsIf: (Action_Param:'add_action')!='';  $action = 'add_action';  $dbChange = 1;Else: (Action_Param:'update_action')!='';  $action = 'update_action';  $dbChange = 1;Else: (Action_Param:'delete_action')!='';  $action = 'delete_action';  $dbChange = 1;Else: (Action_Param:'delet2_action')!='';  $action = 'delet2_action';  $dbChange = 1;Else: (Action_Param:'upload')!='';  $action = 'upload';  $dbChange = 1;/If;/* fieldCounter is used to label searchform fieldsbecause sometimes there are 2 searchfields on the searchform  both targeting the same db field; thus dbfieldname is not adequateas a label. Also, searchform output must never use formparam names that could be identical to the editform formparam names*/// file upload vars    If: $allowFileupload == 'yes';	Var:'content_path' 	= (LB_getOption:'fileupload_realpath');	Var:'upload_filename' 	= (Action_Param:'upload_filename');	Var:'upload_path'     	= (Action_Param:'upload_path');	Var:'upload_description'= (Action_Param:'upload_description');	Var:'upl_catid' 	= (Action_Param:'upl_catid');	// this one for file remove (in LassoBlogger, page upl-list.lasso)	Var:'file' = (Action_Param:'file');	// check content_path (defined in Options)	If: $content_path == '';	    $speakBubble = 'To facilitate file uploads, please set the option <code>fileupload_realpath</code> on admin page Options > Manage Files!';	Else: !($content_path -> (EndsWith:'/'));	    $content_path += '/';	/If;	If: !($content_path -> (BeginsWith:'/'));	    $speakBubble = 'The option <code>fileupload_realpath</code> on the admin page Options > Manage Files should begin with a slash! Please correct';	/If;	If: $speakBubble != '';	    Include:$fromMetoRoot + 'inc/speakBubble.inc';	/If;    /If; // end file upload varsIterate: $searchFields,(Variable:'this');    $fieldCounter += 1;    If: !($search || $dbChange); 	    // odd patch...	    // we may have params from the  address line of browser	Variable:'inputvalue' = (Action_Param: ($this -> (Get:1)));    Else;	Variable:'inputvalue' = (Action_Param: 'searchparam' + $fieldCounter);    /If;	Variable:'that'= 'searchparam' + $fieldCounter;// for forms    Variable:'that_forDB'= ($this -> (Get:1));     // for db search    Variable:$that = $inputvalue;     If:(Variable:$that) != ''; // if searchfield not empty	If: $this -> Size > 10; // if searchop defined	    If: $this -> (get:11) != '';		$hakuinlinestuff -> (Insert:'-Op' = ($this -> (Get:11)));	    /If;	/If;	$linkstuff += $that + '=' + (Variable:$that)+'&';	$formstuff += '<input type=\"hidden\" name=\"'+ $that + 		'\" value=\"' + (Variable:$that)+'\">\r';	$searchToggle = 'doSearch'; // jos ei yhtään hakutermiä, 				    // ja riippuen searchbehavior-				    // muuttujasta, hakua ei ehkä				    // tehdä// 	'test: linkstuff = ' + $linkstuff + ', ';// 	'test: formstuff = ' + $formstuff + ', ';	// case: datebegin, dateend	If: $this -> (Get:8) == 'datebegin';	    If:(Date:(Variable:$that),-Format=$date_showformat) -> Type 		== 'date';  		// if wellformed		$hakuinlinestuff -> (Insert:'-Op' = 'gte');		$hakuinlinestuff -> (Insert:$that_forDB = 		(Date_Format:(Date:(Variable:$that),-Format=$date_showformat),		  -Format=$date_dbformat)		  );	   /If; 	Else: $this -> (Get:8) == 'dateend';	    If:(Date:(Variable:$that),-Format=$date_showformat) -> Type		== 'date';		// if wellformed		$hakuinlinestuff -> (Insert:'-Op' = 'lte');		$hakuinlinestuff -> (Insert:$that_forDB = 		(Date_Format:(Date:(Variable:$that),-Format=$date_showformat),		  -Format=$date_dbformat)		  );	    /If;	Else:   ($this -> (Get:8)) == 'date';	// case: date (pvm-kentät)	    If:(Date:(Variable:$that),-Format=$date_showformat) -> Type		== 'date';		// if wellformed		$hakuinlinestuff -> (Insert:$that_forDB = 		(Date_Format:(Date:(Variable:$that),-Format=$date_showformat),		  -Format=$date_dbformat)		  );	    /If;	// case: other cases	Else;	    $hakuinlinestuff -> (Insert:$that_forDB = (Variable:$that));	/If;    /If; // if searchfield not empty/Iterate;// add -MaxRecords to hakuinlinestuff    If:   $viewtype == 'listview';	$hakuinlinestuff -> (Insert:'-MaxRecords' = $maxrecords_listview);     Else: $viewtype == 'formview';	$hakuinlinestuff -> (Insert:'-MaxRecords' = $maxrecords_formview);     /If;    // nämä pitää restauroida uudestaan -updaten jälkeen// add default search params to hakuinlinestuff    If:   $defaultSearch != (Array);	Variable:'i' = '';	Iterate: $defaultSearch, $i;	$hakuinlinestuff -> (Insert:($i->(Get:1)) = ($i->(Get:2)) ); 	/Iterate;    /If;// 'test: hakuinlinestuff pre processing = ' + $hakuinlinestuff + '<br>';Variable:'inlinestuff'=(Array);Iterate: $editFields,(Variable:'this');If:    (($this->(Get:8)) == 'date') && $dbtype == 'mysql';     // case: date (mysql-tietokantaan  muodossa yyyy-mm-dd hh:mm:ss)    If: (Action_Param:($this -> (Get:1))) != ''; // if not empty	Variable:'temp' = 	(Date:(Action_Param:($this -> (Get:1))),-Format='%d.%m.%Y %H:%M:%S');	$temp = $temp -> (Format:'%Q %H:%M:%S');	Variable:($this -> (Get:1)) = $temp;    Else;	Variable:($this -> (Get:1)) = ''; // case: empty date    /If; Else: (($this->(Get:8)) == 'date'); // other date 	If: (Action_Param:($this -> (Get:1))) != ''; // if not empty	    Variable:($this -> (Get:1)) = 	      (Date_Format:(Date:(Variable:$that),-Format=$date_showformat),	      -Format=$date_dbformat);	Else;	    Variable:($this -> (Get:1)) = ''; // case: empty date	/If; Else;   // if not date	Variable:($this -> (Get:1)) = (Action_Param:($this -> (Get:1)));	Variable:($this -> (Get:1)) -> Trim;/If;	// check for design error	If: $this -> (Get:1) -> (BeginsWith:'haku');	$speakBubble = 'Kentän nimi ei saa alkaa \"haku\"! Korjaa tietokanta ' +	'ja editFields-muuttuja!';	Include: $fromMeToRoot + $myInc + 'speakBubble.inc';	Abort;	/If;    If: $this -> (Get:3) != 'nosave' &&        $this -> (Get:3) != 'creationDate' &&        $this -> (Get:3) != 'modDate' &&          ($this -> (Get:3) != 'saveIfNotEmpty' ||	  (Variable:($this -> (Get:1))) != '');	    If: $this -> (Size) > 11; // if encrypt (#12) is defined		If: $this -> (Get:12) == 'md5';		    $inlinestuff -> (Insert:($this -> (Get:1)) = 		      (Encrypt_MD5:(Variable:($this -> (Get:1)))));		Else;		    $inlinestuff -> (Insert:($this -> (Get:1)) 		      = (Variable:($this -> (Get:1))));		/If;	    Else;	// encrypt not defined		    $inlinestuff -> (Insert:($this -> (Get:1)) 		      = (Variable:($this -> (Get:1))));	    /If;    Else: $this -> (Get:3) == 'creationDate' && $action == 'add_action'; 		    $inlinestuff -> (Insert:($this -> (Get:1)) 		      = (Date_Format:(Date),-Format=$date_dbformat));    Else: $this -> (Get:3) == 'modDate' &&     ($action == 'add_action' || $action == 'update_action'); 		    $inlinestuff -> (Insert:($this -> (Get:1)) 		      = (Date_Format:(Date),-Format=$date_dbformat));    Else;	    // don't save!    /If;	/Iterate;// add default search params to inlinestuff// NOTE: this is better done "manually", as it may not be wanted in all cases//     If:   $defaultSearch != (Array);// 	Variable:'i' = '';// 	Iterate: $defaultSearch, $i;// 	$inlinestuff -> (Insert:($i->(Get:1)) = ($i->(Get:2)) ); // 	/Iterate;//     /If;// 'test: inlinestuff = ' + $inlinestuff + '<br>';If: $dbChange == 1;  // long section//  *** validaatio - validation ***// #1. required fields	    (add, update)// #2. unique fields	    (add, update)// #3  email validation	    (add, update)// #4. alphanumeric	    (add, update)// #5a. custom		    (add, update)// #5b. custom		    (delete)If: $action == 'add_action' || $action == 'update_action';    // #1. required fields    Iterate: $editFields, $this;	If: ($this -> (Get:4)) >> 'req';	    If: (Var:($this -> (Get:1))) == '';	// 	($this -> (get:1)) + ' is empty';		If: $lang=='fi';		$speakBubble +='Anna <b>' + ($this -> (Get:2)) + '!</b><br>';		Else;		$speakBubble +=(str:'Please give') + ' <b>' + 		    ($this -> (Get:2)) + '</b>!<br>';		/If;	    /If;	/If;    /Iterate;    // #2. unique fields    Iterate: $editFields, $this;    If: ($this -> (Get:4)) >> 'unique';	inline: $dbConfig, -table=$table_prefix+$myTable,	-Op='eq',	$this -> (Get:1) = (Var:($this -> (get:1))),	-search;	If: (($action == 'add_action' && (Found_Count) > 0) ||	    ($action == 'update_action' && (Found_Count) > 1))  	    ;	    If: $lang == 'fi';		$speakBubble += 'Kentän <b>' + $this -> (get:2) + '</b> arvo on jo käytössä. Vaihda kentän arvo.<br>';	    Else;		$speakBubble += (str:'Duplicate value in the field') + ' <b>' +		   $this -> (get:2) + '<br>';	    /If;	/If; // if found_count    /Inline;    /If; 			// end if unique    // #3 Email validaton    If: ($this -> (Get:4)) >> 'email' && (Var:($this -> (Get:1))) != '';	If: !(Valid_Email: (Var:($this -> (get:1))));	    If: $lang == 'fi';		$speakBubble += 'Email-osoite kentässä <b>' + $this -> (get:2) + '</b> ei ole validi.<br> ';	    Else;		$speakBubble += (str:'The email address in field') + ' <b>' + 		  $this -> (get:2) + '</b> ' + (str:'is not valid.') + '<br>';	    /If;	/If; // end if not valid    /If;  // end email validation    // #4 Alphanumeric validaton    If: ($this -> (Get:4)) >> 'alphanumeric' && (Var:($this -> (Get:1))) != '';	If: !(String_IsAlphaNumeric: (Var:($this -> (get:1))));	    If: $lang == 'fi';		$speakBubble += 'Kentässä <b>' + $this -> (get:2) + '</b> ovat 		   sallittuja merkkejä vain kirjaimet (a-z, A-Z) ja numerot.<br> ';	    Else;                $speakBubble += (str:'Only alphanumeric characters (a-z, A-Z and 0-9) are allowed in the field') + ' ' + ($this -> (get:2)) + '<br>';	    /If;	/If; // end if not valid    /If;  // end alphanumeric validation    // #5a. Custom validation for add & update    If: $customValidations == 'yes' &&        $this -> (Get:3) != 'nosave' &&        $this -> (Get:3) != 'creationDate' &&        $this -> (Get:3) != 'modDate' &&          ($this -> (Get:3) != 'saveIfNotEmpty' ||	  (Variable:($this -> (Get:1))) != '');    Include:$fromMetoRoot + 'admin/custom/validation/' + $myfilebody + '.inc';    /If;    // end custom validation    /Iterate;/If;  				// end if action==add_action || action==update_action // #5b. Custom validation for deleteIf: $action == 'delete_action' && $customValidations == 'yes';    Include:$fromMetoRoot + 'admin/custom/validation/' + $myfilebody + '.inc';/If;// last thing -  the speakBubble handler	    If: $speakBubble != '';		If: $lang == 'fi';		    $speakBubble += 'Ole hyvä ja yritä uudelleen.';		else;		    $speakBubble += 'Please try again.';		/if;		Include: $fromMeToRoot + $myInc + 'speakBubble.inc';		Variable:'dbChange_error' = 'validation failed';	    /If; // end validation// 'TEST: keyvalue = ' + $keyvalue + '<br>';If: $action=='update_action' && $dbChange_error == '';  // if actioninline: $dbConfig, -table=$table_prefix+$myTable,-keyfield='id',-keyvalue=$keyvalue,$inlinestuff,-update;if: (Error_CurrentError)!=(Error_NoError);	$dbChange_error = (Error_CurrentError);    If: $lang == 'fi';	$speakBubble='Tietueen päivitys ei onnistunut. Tietoja virheestä: '+	(Error_CurrentError:-ErrorCode) + ', ' + (error_currenterror);    Else;	$speakBubble='The update FAILED. More info: ' + 	(Error_CurrentError:-ErrorCode) + ', ' + (error_currenterror);    /If;    Include: $fromMetoRoot + $myInc + 'errorhandler_debug.inc';Else;    If: $lang == 'fi';    $speakBubble='Tietue päivitetty.';    Else;    $speakBubble='The update was successful.';    /If;/If;Include:$fromMetoRoot + $myInc + 'speakBubble.inc';If: $updatebehavior == 1;    // behavior #1: search kept, updated rec shown only if search allows this    Else: $updatebehavior == 2;    // behavior #2: search bypassed, only updated rec shown    // hakulomakkeen tyhjennys    Iterate: $searchFields,(Variable:'this');    Variable:('haku'+ ($this->(Get:1))) = '';    /Iterate;    // hakuarvojen poisto haku-inlinesta     $hakuinlinestuff = (Array);    $linkstuff = (Array);    // maxrecs-arvojen restaurointi    If:   $viewtype == 'listview';	$hakuinlinestuff -> (Insert:'-MaxRecords' = $maxrecords_listview); 	Else: $viewtype == 'formview';	$hakuinlinestuff -> (Insert:'-KeyValue' = $keyvalue); 	$hakuinlinestuff -> (Insert:'-MaxRecords' = $maxrecords_formview); 		// tämä ei toimi listview-näkymässä    /If;         Variable:'keyvalue'=(KeyField_Value);/If;/Inline;?>[Else: $action == 'delete_action']<p class="center"><b>[If: $lang == 'fi']Poistetaanko tietue?[Else]Delete the record?[/If]</b></p><?LassoScript// patch for uploadfile deleteVar:'temp' = '';    If: $allowFileupload == 'yes';	    // LASSOBLOGGER SPECIAL COMMENT	    // vars upl_path and upl_name are db fields,	    // vars should exist in case the page is upl-fileedit.lasso        If: (Variable_Defined:'upl_path') &&  (Variable_Defined:'upl_name');//        $temp = '&file=' + (Encode_URL:$upl_path + $upl_name);        $temp = '<input type="hidden" name="file" value="' 	    + $upl_path + $upl_name + '">';        /If;    /If;?><form class="center" action="[$myfilename]" method="POST">[$formstuff][$temp]<input type="hidden" name="keyvalue" value="[$keyvalue]"><input type="hidden" name="skip" value="[$skip]"><INPUT TYPE="Submit" NAME="delet2_action" VALUE="Ok"><INPUT TYPE="Submit" NAME="-nothing" VALUE="[If: $lang=='fi']Peru[Else]Cancel[/If]"></FORM>[Abort]<?LassoScript //>// old code// <p class="center"> <A HREF="[$myfilename]?[$linkstuff]delet2_action=yes&keyvalue=[$keyvalue][$temp]">[If: $lang=='fi']Ok[Else]Ok[/If] &raquo;</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// // <A HREF="[$myfilename]?// [$linkstuff]skip=[$skip]">[If: $lang=='fi']Peru[Else]Cancel[/If] &raquo;</A></p>Else: $action == 'delet2_action'; // delet2_actioninline: $dbConfig, -table=$table_prefix+$myTable,-KeyField='id',-KeyValue=$keyvalue,-delete;If: (Error_CurrentError)!=(Error_NoError);    If: $lang == 'fi';    $speakBubble = 'Tietueen poistaminen ei onnistunut. Tietoja virheestä:';    Else;    $speakBubble = 'The delete operation FAILED. More info:';    /If;    $speakBubble += (Error_CurrentError:-ErrorCode)+', '+(error_currenterror);    $dbChange_error = (Error_CurrentError);Else;    If: $lang == 'fi';    $speakBubble = 'Tietue poistettu.';    Else;    $speakBubble = 'A record has been deleted.';    /If;/If;Include:$fromMetoRoot + $myInc + 'speakBubble.inc';/Inline;// Iterate: $searchFields,(Variable:'this');// Variable:('haku'+$this) = '';// /Iterate;Else: $action == 'add_action' && $dbChange_error == '';   // add_actionInline: $dbConfig, -table=$table_prefix+$myTable,-KeyField='id',-KeyValue=$keyvalue,$inlinestuff,-add;If: (Error_CurrentError)!=(Error_NoError);	$dbChange_error = (Error_CurrentError);    If: $lang == 'fi';    $speakBubble += 'Tietueen lisääminen ei onnistunut. Tietoja virheestä: ';    Else;    $speakBubble += 'The add operation FAILED. More info: ';    /If;$speakBubble += (Error_CurrentError:-ErrorCode) + ', ' + (error_currenterror);Include: $fromMetoRoot + $myInc + 'errorhandler_debug.inc';Include:$fromMetoRoot + $myInc + 'speakBubble.inc';Abort;Else;    If: $lang == 'fi';    $speakBubble += 'Tietue lisätty.';    Else;    $speakBubble += 'A record has been added.';    /If;/If;Include:$fromMetoRoot + $myInc + 'speakBubble.inc';    Variable:'keyValue'=(KeyField_Value);    // hakulomakkeen tyhjennys//    Iterate: $searchFields,(Variable:'this');//    Variable:('haku'+ ($this->(Get:1))) = '';//    /Iterate;// hakuarvojen poisto haku-inlinesta     If:   $viewtype == 'formview';      $hakuinlinestuff = $defaultSearch;    // lisätty tietue pitäisi löytää haulla    $hakuinlinestuff -> (Insert:'-keyValue' = $keyValue);    /If;//    $linkstuff = (Array);//    Variable:'keyvalue'=(KeyField_Value);/Inline;Else: $action == 'upload';    // first some checks with abort action	// are uploads switched on?	If: (LB_GetOption:'use_fileupload') != 1;	    $speakBubble += 'File uploads are not allowed in Options!<br>';	/If;	// user privileges?	If: $userlevel_ses >= (LB_GetOption:'fileupload_minlevel');	    $speakBubble += 'Your userlevel is too low! ' + 	    	'Uploads are not allowed.<br>';	/If;	// has the user defined a file to upload?	Var: 'uploadErr' = 0;	If: !(File_Uploads -> Size);	    $speakBubble += 'Please give a file to upload!<br>';	/If;	If: $speakBubble != '';	    Include: $fromMeToRoot + $myInc + 'speakBubble.inc';	    Abort;	/If;     // set username & password	Inline: $dbConfig,		-Nothing;    // BEGIN VALIDATIONS    // content_path (set in Options) has already been validated (above)    // validate upload_path    If: !($upload_path -> Size);	$speakBubble += 'Please give an upload path!<br>';	$uploadErr = 21;    Else: $upload_path -> Size == 1;	$speakBubble += 'The upload path should be longer than 1 char!<br>';	$uploadErr = 22;    Else;	If: $upload_path >> ' ';	    $speakBubble = 'The upload path should NOT contain spaces! ' +		    'Please correct!<br>'; 		    $uploadErr = 23;	/If;	If: !($upload_path -> (EndsWith:'/'));	    $upload_path += '/';	/If;	If: $upload_path -> (BeginsWith:'/');	    $speakBubble += 'The upload path should NOT begin with a slash! ' +		    'Please correct!<br>';	    $uploadErr = 24;	/If;    /If;    // validate upload_filename    If: !($upload_filename);	$speakBubble += 'Please give a filename.<br>';	$uploadErr = 31;    Else;        // check for illegal chars	If: (string_findregexp: $upload_filename, 	-find="[^a-z0-9\\!\\@\\#\\$\\%\\(\\)\\{\\}\\-\\_\\+\\~\\,\\.]", -ignorecase)->size > 0;	$speakBubble += 'Please don\'t use special characters or spaces in the filename.<br>';	$uploadErr = 32;	/if;	// dot(s) and suffixes	Var:'aName' = $upload_filename -> (Split:'.');	If: $aName -> Size == 1;	    $speakBubble += 'Please give the file suffix ' + 	    	'(for example ".jpg") in the filename.<br>';	    $uploadErr = 33;	Else: $aName -> Size > 2;	    $speakBubble += 'Please use only one dot (.) in the filename.<br>';	    $uploadErr = 34;	Else: $aName -> Size == 2; // ok case	    Var:'suffix' = $aName -> (Get:2);	    Var:'allowedSx' = (LB_GetOption:'fileupload_allowedtypes') 	    	-> (Split:' '); 	    If: $allowedSx -> (Find:$suffix) == (Array);		$speakBubble += 'The file suffix .' + $suffix +			' is not allowed.<br>';		$uploadErr = 35;	    /If;	/If;    /If;// 'test: filename = '; $upload_filename; '<br>';// 'test: cont path = '; $content_path; '<br>';// 'test: upload path = '; $upload_path; '<br>';// validate folder names & create folders    Var: 'aPath' = ($content_path + $upload_path) -> (Split:'/');    $aPath -> (Remove:1); $aPath -> (Remove);    // 'test: ' + $aPath + '<br>';    var:'i' = String; var:'j' = String;    Iterate: $aPath, $i;        $j += '/' + $i;	If: (File_Exists: $j) && (File_IsDirectory:$j);	    // 'test: ' + $j + ' exists!<br>';	Else;	    File_create: ($j + '/');	    If: (File_CurrentError) == 'No error';	    $speakBubble += 'The directory ' + $j + ' was created! You may have to manually check its permissions; the user "Lasso" should have full rights to the directory.<br>';	    Else;	    $speakBubble += 'Tried to create the directory ' + $j + ' but	    encountered an error: ' + (File_CurrentError) + '. Please check a)	    file permissions and b) your blog user privileges set on Lasso\'s admin pages. See blog docs in <code>docs/lb_uploads.txt</code><br>';	    /If;	/If;    /Iterate;    Var:'mThisfile' 	= (File_Uploads) -> (Get:1);    // validate file size     If: $mThisfile -> (Find:'Upload.size') == 0;	$speakBubble += 'The file size seems to be 0. ' + 		'Does the given file really exist?<br>';	$uploadErr = 41;    Else: $mThisfile -> (Find:'Upload.size') > (1000 * (Integer:(LB_GetOption:'fileupload_maxk')));	$speakBubble += 'The file size (' + $mThisfile->(Find:'Upload.size') + 		') exceeds the max size set in Options!<br>';	$uploadErr = 42;    /If;// check that the file doesn't exist yet    If: $uploadErr == 0;    If: (File_Exists:$content_path + $upload_path + $upload_filename);	$speakBubble += 'In the given directory there already exists a file with this name. Delete it first, or use another name!<br>';	$uploadErr = 51;    /If;    /If;// END validations & folder manipulations// do the upload    If: $uploadErr == 0;	File_Copy: $mThisfile -> (Find:'Upload.Name'), 		$content_path + $upload_path + $upload_filename, -FileOverwrite;	    If: (File_CurrentError:-ErrorCode) == 0;		If: $lang == 'fi';		$speakBubble += 'Tiedostonsiirrossa ei raportoitu virheitä.<br>';		$speakBubble += 'Polku on ' + $content_path + $upload_path + $upload_filename + '.<br>';		$speakBubble += 'Voit hallita tiedostoja näiden ylläpitosivujen osastossa Uploads.<br>';		Else;		$speakBubble += 'No errors were reported in file upload.<br>';		$speakBubble += 'The path is ' + $content_path + $upload_path + $upload_filename + '.<br>';		$speakBubble += 'You can manage your uploaded files in the Uploads section of these admin pages.<br>';		/If;	    Else;		$uploadErr = 91;		$speakBubble += 'Errors were reported in file upload.';		$speakBubble += 'More info: ' + File_CurrentError + '<br>';	    /If;    Else; // case uploadErr	    $speakBubble += 'Upload was not executed. ' + 		'Error code was ' + $uploadErr + '.<br>';    /If;	/Inline;    // now handle database entries    If: $upl_catid == ''; $upl_catid = '-1'; /If;        If: $uploadErr == 0; // if everything is ok so far	inline: $dbConfig, -table=$table_prefix+'uploads',	    'upl_postid'= $KeyValue,	    'upl_catid'= $upl_catid,	    'upl_name'=$upload_filename,	    'upl_path'=($content_path + $upload_path),	    'upl_description'=$upload_description,	    'upl_created'=$nowMySQL,	    'upl_modified'=$nowMySQL,	    'upl_userid'=$user_ses,	    -Add;	If: (Error_CurrentError)!=(Error_NoError);		$dbChange_error = (Error_CurrentError);	    If: $lang == 'fi';	    $speakBubble += 'Tietueen lisääminen ei onnistunut. ' + 	    	'Tietoja virheestä: ';	    Else;	    $speakBubble += 'The add db operation FAILED. More info: ';	    /If;	    $speakBubble += (Error_CurrentError:-ErrorCode) + ', ' + 	    	(error_currenterror);	    // Include: $fromMetoRoot + $myInc + 'errorhandler_debug.inc';	    // 'test: keyval = ' + $keyvalue + '<br>';	Else;	    If: $lang == 'fi';	    $speakBubble += 'Tietue lisätty.';	    Else;	    $speakBubble += 'A record has been successfully added to the db.';	    /If;	/If;	/Inline;    /If; // end if uploadErr == 0    // END handling database entries    If: $speakBubble != '';	Include:$fromMetoRoot + 'inc/speakBubble.inc';    /If;/If;   // end if action/If;   // if dbChange=1//  *** hakulomake *** // test, if searchform should be shownVar:'showToggle' = '';    // check searchFields    If: $searchFields != (Array); 	Iterate:$searchFields, (Var:'this');	    If: $this -> (Get:3) != 'hidden';	    $showToggle = 'show';	    /If;	/Iterate;    /If; If: $showToggle == 'show'; // there are showable searchfields, so show!?><form action="[$myfilename]" method="POST"><input type="hidden" name="search" value="1"><table cellpadding="2" cellspacing="2" class="center"><tr BGCOLOR="#CCCCCC"><td class="pieni" align="center" colspan="2"><B>[If: $lang == 'fi']Hae [$rectype_fi_part][Else]Search [$rectype_en_part][/If] [If: $lang == 'fi']editoitavaksi[Else]to be edited[/If]:</B></td></tr><tr><td class="pieni"><?LassoScript //>Variable:'nobreak_setting' = ''; // used to pass info from prev searchfield 				 // to the next one    // have to check first, if there are nobreak-settings    Variable:'nobreak_exists' = '';	Iterate: $searchFields, (Var:'this');	    If: $this -> (Get:10) == 'nobreak';	    $nobreak_exists = 'yes';	    /If;	/Iterate;Variable:'fieldCounter' = 0; 	// actionparam names will be "searchparam1" etc.Iterate: $searchFields, (Var:'this');$fieldCounter += 1;If: $this -> (Get:3) != 'hidden';// break or nobreak?    If: ($fieldCounter != 1 && $nobreak_setting == 'nobreak') ||         ($fieldCounter == 1 && $this -> (Get:10) == 'nobreak');     				// setting of prev record used here	'&nbsp;&nbsp;'; $this -> (Get:2); '&nbsp;';	// kentän nimi    Else: ($fieldCounter != 1 && $nobreak_setting != 'nobreak') ||          ($fieldCounter == 1 && $this -> (Get:10) != 'nobreak');     				// nobreak_setting!='nobreak && not 1st rec	// kentän nimi	'<tr><td class="pieni">' + $this -> (Get:2);	// contents cell	If: $nobreak_exists != 'yes';	    '</td><td class="pieni">';	/If;    /If;    $nobreak_setting = $this -> (Get:10); // setting updatedVariable:'i' = (Var:('searchparam' + $fieldCounter),-Encodehtml);// date - muunna pvm    If: ($this -> (Get:8)) >> 'date' && $i != ''; 	If: (Date:$i,-Format=$date_showformat) -> Type != 'date';// date not valid	    Variable:'fieldvalue' = $i;	    If: $lang == 'fi';	    $speakBubble = 'Hakupäivämäärässä tuntuu olevan jotain vikaa - tarkista!';	    Else;	    $speakBubble='The search date seems to be malformed - please check!';	    /If;	Else; 					// date is valid	    Variable:'fieldvalue' = $i;	/If; 					// end if valid    Else;					// case: not date    Variable:'fieldvalue' = $i;    /If; // 'test:i=' + $i + ',fv=' + $fieldvalue;// end date muunna pvm If: ($this -> (Get:3)) == 'text'; 	// case text'<input type=\"' + ($this -> (Get:'3')) + '\" name=\"';'searchparam' + $fieldCounter;    '\" size=\"';	If: ($this -> (Get:5)) == ''; // use default size	$size1default; Else; ($this -> (Get:5)); 	/If;    '\" value=\"' + $fieldvalue + '\">';    $this -> (Get:7); // helppiteksti    ' \r';Else: ($this -> (Get:3)) == 'select';	// case selectVariable:'valuelist' = ($this -> (Get:5)) -> (Split:';');Variable:'showlist' = ($this -> (Get:6)) -> (Split:';');'\r<select name=\"searchparam' +  $fieldCounter;'\" size=\"1\">\r';Loop: ($valuelist -> Size);    '<option value=\"' + ($valuelist -> (Get:(Loop_Count))) + '\"';    If: $fieldvalue == ($valuelist -> (Get:(Loop_Count)));     ' SELECTED';    /If;    '>' + ($showlist -> (Get:(Loop_Count))) + '</option>\r';/Loop;    ($this -> (Get:7)); // helppiteksti'</select>\r';Else: ($this -> (Get:3)) == 'radio';	// case radioVariable:'valuelist' = ($this -> (Get:5)) -> (Split:';');Variable:'showlist' = ($this -> (Get:6)) -> (Split:';');Loop: ($valuelist -> Size);'\r<INPUT TYPE=\"radio\" NAME=\"searchparam' +      $fieldCounter + '\" VALUE=\"';($valuelist -> (Get:(Loop_Count))) + '\"';    If: $fieldvalue == ($valuelist -> (Get:(Loop_Count)));     ' CHECKED';    /If;'> ' + ($showlist -> (Get:(Loop_Count))) + ' \r';/Loop;    ($this -> (Get:7)); // helppiteksti    '\r';Else: ($this -> (Get:3)) == 'override'; 	// case override    If: $this -> (Get:9) != '';	Process:$this -> (Get:9); 	// custom code	    /* this will include the fielvalue from db, 	        if #9 refers to [$fieldvalue] */    /If;    ($this -> (Get:7)); 		// help text    ' \r';/If; // end type    If: ($this -> (Get:10)) != 'nobreak'; // break or nobreak?    '</td></tr>';    /If;/If; // end if hidden/Iterate;?></td><td><INPUT TYPE="Submit" NAME="-nothing" VALUE="[If: $lang == 'fi']Hae[Else]Search[/If]"><INPUT TYPE="Hidden" NAME="-nothing" VALUE="Hae"></td></tr></table></FORM><?LassoScript //>	// end hakulomake/If; 	// end if searchFields != (Array)// custom searchvalidations     If: (Variable_Defined:'searchValidations');	If: $searchValidations == 'yes';	Include:$fromMetoRoot + 'admin/custom/searchvalidation/' 	    + $myfilebody + '.inc';	/If;    /If;// speakBubble for searchvalidations 			    If: $speakBubble != '';			    Include: $fromMetoRoot + $myInc + 'speakBubble.inc';			    Abort;			    /If;If: $searchBehavior == 2 && $searchToggle == '';	// there are no search terms	If: $lang == 'fi';	$speakBubble='Ole hyvä ja anna hakukriteerejä!';	Else;	$speakBubble='Please do a search!';	/If;    Include:$fromMetoRoot + $myInc + 'speakBubble.inc';    Abort; /If;// 'test: hakuinlinestuff pre main search = ' + $hakuinlinestuff + '<br>';// the main searchinline: -search, $dbConfig, -table=$table_prefix+$myTable,    -KeyField='id',    $hakuinlinestuff,    -skipRecords=$skip,    $sortstuff;// show search_args// Include: $fromMetoRoot + $myInc + 'errorhandler_debug.inc';Variable:'foundCount' = (Found_Count);Variable:'errorcode' = (Error_CurrentError:-ErrorCode);if: $action == 'delet2_action';Else: (($errorcode == '-1728' && $dbType == 'fmp')|| ($foundCount == 0 && $dbType == 'mysql'))&& $dbChange == 1;   // no records found, though there really should have been...   If: $dbChange_error == ''; // if validation failed, don't tell	    If: $lang == 'fi';	    $speakBubble='Virhe - Tietueita ei l&ouml;ytynyt!';	    Else;	    $speakBubble='Error - No records were found!';	    /If;	Include:$fromMetoRoot + $myInc + 'speakBubble.inc';	Include:$fromMetoRoot + $myInc + 'errorhandler_debug.inc';    /If;Else: (($errorcode == '-1728' && $dbType == 'fmp')|| ($foundcount == 0 && $dbType == 'mysql'));    // no records found, but it's no big deal	If: $emptyForm == 'yes';	    // don't tell nothing was found	Else;	    If: $lang == 'fi';		$speakBubble= (LB_titleCase:$rectype_fi_part) + ' ei löytynyt';		Else;		$speakBubble='No ' + $rectype_en_part + ' were found';	    /If;	    Include:$fromMetoRoot + $myInc + 'speakBubble.inc';	    $emptyform = 'yes'; // added 060726	/If;Else: (Error_CurrentError) != (Error_NoError);    If: $lang == 'fi';    $speakBubble='Tapahtui virhe. Tietoja virheest&auml;: ';    Else;    $speakBubble='An error occurred! More info: ';    /If;    $errorcode + ', ' + (error_currenterror);    Include:$fromMetoRoot + $myInc + 'speakBubble.inc';/If;// custom postprocess    If: (Variable_Defined:'customPostprocess');	If: $customPostprocess == 'yes';	Include:$fromMetoRoot + 'admin/custom/postprocess/' 	    + $myfilebody + '.inc';	/If;    /If;// naviglinks// don't show, if action=add)If: !(Variable_Defined:'showNaviglinks');    Variable:'showNaviglinks' = '';    If: $action == 'add_action';    $showNaviglinks = 'no';    /If;    If: (Found_Count) < 1;	$showNaviglinks = 'no';    /If;    If: $emptyForm == 'yes';	$showNaviglinks = 'no';    /If;/If;If: $showNaviglinks != 'no';    // If: $viewtype == 'formview';	Include:$fromMetoRoot + $myInc + 'snip_naviglinks.inc';	Include:$fromMetoRoot + $myInc + 'snip_hr.inc';	'<br>';    // /If;Else;    '<br>';/If;?>[Output_None]   ***  editointilomake  ***   [/Output_None]<TABLE CELLSPACING="2" CELLPADDING="0" class="center"><?LassoScript //>// define what should be iteratedIf: $emptyForm == 'yes';                // otherwise show empty form            Var:'iterated' = $addFields;    Else;    Var:'iterated' = $editFields;    /If;// If: $emptyForm == 'yes' || ($emptyForm != 'yes' && (Found_Count) > 0);		// show header texts only if there is a form    if: ($viewtype == 'listview') && 			// case listview	!($action == 'delet2_action' && (Found_Count) == 0);    '<tr>';   				// nimilaput    Iterate: $iterated, (Var:'this');	If: ($this -> (Get:3)) != 'hidden' 	    && $this -> (Get:3) != 'moddate'	    && $this -> (Get:3) != 'creationdate';	    '<th scope="col" STYLE="text-align:left;padding-right:10px;">'; 	    $this -> (Get:2); // nimilappu		If: ($this -> (Get:4)) >> 'req'; 		$reqFieldsFound = 'yes';		'*'; 		/If; // if pakollinen kenttä	    '</th>\r';	/If;    /Iterate;    '</tr>\r';    '<tr>';				// helppitekstit    Iterate: $iterated, (Var:'this');	If: ($this -> (Get:7)) != ''; // helppiteksti	    '<td valign="top" class="' + $defaultClass + '">'; 	    $this -> (Get:7); // helppiteksti	    '</td>\r';	/If;    /Iterate;    '</tr>\r';    /If; 					// end case listview// /If;						// end emptyform etc.Records;If: ($emptyForm != 'yes'  && $dbChange  != 1)   || $action == 'update_action'   || ($action == 'add_action' && $dbChange_error == '')  || ($action == 'delet2_action' && (Found_Count) > 0)  || $action == 'upload';     // for this case: show editform & upload form & filemove form    // for other cases, show only empty form (scroll down)//    'test'; 'empty '; $emptyForm; ', action'; $action;//    ', val.'; $dbChange_error;?><form name="MyForm" action="[$formTargetpage]" method="POST"><input type="hidden" name="-ResponseRequiredFieldMissingError" value="[$myfilename]"><input type="hidden" name="keyvalue" value="[KeyField_Value]">[$formstuff][Var:'COMMENT'='* hakumuuttujat *']<input type="hidden" name="skip" value="[$skip]"><?LassoScript    // edit form    Include: $fromMetoRoot + 'inc/admin_editform.inc';'</FORM>';    // file upload form (will come again for addform, sorry!    If: $allowFileupload == 'yes';	If: (LB_GetOption:'use_fileupload') == 1	    && (Integer:$userlevel_ses) >= 	       (Integer:(LB_GetOption:'fileupload_minlevel'))	    && (Loop_Count) == (Shown_Count); // last one is for listview    '<tr STYLE="">';?><form name="fileUpload" action="[$formTargetpage]" method="POST" enctype="multipart/form-data">    <input type="hidden" name="-ResponseRequiredFieldMissingError" value="[$formTargetpage]">    <input type="hidden" name="keyvalue" value="[KeyField_Value]">    [$formstuff][Var:'COMMENT'='* hakumuuttujat *']    <input type="hidden" name="skip" value="[$skip]">    <th align="right" valign="top" style="padding:20px 10px 0 0;border-top:1px solid black;">File upload</th>    <td STYLE="border-top:1px solid black; padding-top:20px;" colspan="10">    <table>	<tr><td>File to upload*</td>	<td colspan="2"><input type="file" name="upload" value=""></td>	</tr>	<?LassoScript    // LASSOBLOGGER SPECIAL	If: $myfilename != 'man-postedit.lasso';	'<tr><td>Category</td>';	'<td colspan="2">';	    Inline:-FindAll,$dbConfig,		  -table=$table_prefix+'uploadcats',		  -KeyField='id',		  -SortField='upc_name';		'<select name="upl_catid" size="1">\r';		    Records;			'<option value="'; Field:'id'; '">'; Field:'upc_name';			'</option>\r';		    /Records;		'</select>';	    /Inline;	'</td>';	'</tr>';	/If; // end if myfilename!=man-postedit.lasso    // END LASSOBLOGGER SPECIAL	?>	<tr>	<td>New name for the file*</td>	<td><input type="text" name="upload_filename" value="[$upload_filename]"></td>	<td>Example: <code>smile.jpg</code>. Do not use spaces or special characters. Remember the file suffix (in the example: <code>.jpg</code>)!</td>	</tr>	<tr>	<td>File Description</td>	<td><input type="text" name="upload_description" value="[$upload_description]"></td>	<td>Recommended: will help you manage your files, and will be shown to blog readers as a tooltip text</td>	</tr>	<?LassoScript	    // LASSOBLOGGER SPECIAL		Var:'temp' = 'uploads/';		If: $myfilename == 'man-postedit.lasso';		    $temp += 'post-related';		    Else;		    $temp += 'filevault';		/If;	    // END LASSOBLOGGER SPECIAL	?>	<tr>	<td>File path*</td>	<td><input type="text" name="upload_path" value="[$temp]"></td>	<td>Relative to the contents path set on the admin page Options > Uploads (currently <code>[$content_path]</code>). The default File path is <code>[$temp]</code>. If specified folders do not exist, LassoBlogger will try to create them for you.</td>	</tr>	<tr><td> </td>	<td>	<INPUT TYPE="Submit" NAME="upload" VALUE="Start upload">	<INPUT TYPE="Hidden" NAME="upload" VALUE="Start upload">	</td></tr>    </table>    </tr></FORM><?LassoScript // '>	/If; // end if option use_fileupload    /If; // end if $allowFileupload    // END upload form & fileMove form/If; // end if (what forms to show)/Records;	If: $allowFileupload == 'yes' && 	    (LB_GetOption:'use_fileupload') != 1;	    '<p>Note: File uploads are disabled in Options</p>';	/If;// don't close the table yet... we may have emptyform=yes/inline;// lisäyslomake If: ((($errorcode == '-1728' && $dbType == 'fmp')	|| ($Foundcount == 0 && $dbType == 'mysql'))	&& $dbChange != 1)     ||  $emptyForm == 'yes'    ||  ($action == 'add_action' && $dbChange_error != '');// the table is still open?><form name="MyForm" action="[$formTargetpage]" method="POST"><input type="hidden" name="lomake" value="addform"><input type="hidden" name="-ResponseRequiredFieldMissingError" value="[$myfilename]"><?LassoScript$formstuff; 		// * hakumuuttujat *$emptyForm = 'yes'; // if we get this far, show empty form anywayInclude: $fromMetoRoot + 'inc/admin_editform.inc';'</FORM>';/If;  // fileupload form, nr 2 (table is still open)    If: $allowFileupload == 'yes' && $uploadform=='yes';	If: (LB_GetOption:'use_fileupload') == 1	    && (Integer:$userlevel_ses) >= 	       (Integer:(LB_GetOption:'fileupload_minlevel'));    '<tr STYLE="">';?><form name="fileUpload" action="[$formTargetpage]" method="POST" enctype="multipart/form-data">    <input type="hidden" name="-ResponseRequiredFieldMissingError" value="[$formTargetpage]">    <input type="hidden" name="keyvalue" value="[KeyField_Value]">    [$formstuff][var:'COMMENT'='* contains search params *']    <input type="hidden" name="skip" value="[$skip]">    <th align="right" valign="top" style="padding:20px 10px 0 0;border-top:1px solid black;">File upload</th>    <td STYLE="border-top:1px solid black; padding-top:20px;" colspan="10">    <table>	<tr><td>File to upload*</td>	<td colspan="2"><input type="file" name="upload" value=""></td>	</tr>	<?LassoScript    // LASSOBLOGGER SPECIAL	If: $myfilename != 'man-postedit.lasso';	'<tr><td>Category</td>';	'<td colspan="2">';	    Inline:-FindAll,$dbConfig,		-table=$table_prefix+'uploadcats',	        -KeyField='id',		-SortField='upc_name';		'<select name="upl_catid" size="1">\r';		    Records;			'<option value="'; Field:'id'; '">'; Field:'upc_name';			'</option>\r';		    /Records;		'</select>';	    /Inline;	'</td>';	'</tr>';	/If; // end if myfilename!=man-postedit.lasso    // END LASSOBLOGGER SPECIAL	?>	<tr>	<td>New name for the file*</td>	<td><input type="text" name="upload_filename" value="[$upload_filename]"></td>	<td>Do not use spaces or special characters. Give the file suffix, too!</td>	</tr>	<tr>	<td>File Description</td>	<td><input type="text" name="upload_description" value="[$upload_description]"></td>	<td>Recommended: will help you manage your files, and will be shown to blog readers as a tooltip text</td>	</tr>	<?LassoScript	    // LASSOBLOGGER SPECIAL		Var:'temp' = 'uploads/';		If: $myfilename == 'man-postedit.lasso';		    $temp += 'post-related';		    Else;		    $temp += 'filevault';		/If;	    // END LASSOBLOGGER SPECIAL	?>	<tr>	<td>File path*</td>	<td><input type="text" name="upload_path" value="[$temp]"></td>	<td>Relative to the contents path set on the admin page Options > Uploads (currently <code>[$content_path]</code>. The default File path is <code>[$temp]</code>. If specified folders do not exist, LassoBlogger will try to create them for you.</td>	</tr>	<tr><td> </td>	<td>	<INPUT TYPE="Submit" NAME="upload" VALUE="Start upload">	<INPUT TYPE="Hidden" NAME="upload" VALUE="Start upload">	</td></tr>    </table>    </tr></FORM><?LassoScript    /If;/If;// end fileupload form, nr 2'</table>';//    ***  end if error=-1728  ***   //    ***  end lisäyslomake    ***   If: $publicPage != '';?><P class="[$defaultClass]" STYLE="text-align:center;margin-left:auto;margin-right:auto;"><FONT SIZE="-1"><A HREF="[$publicPage]" TARGET="_blank">[If:$lang=='fi']Tarkista julkinen sivu (avautuu uuteen ikkunaan)[Else]Check the public page (will open in a new window)[/If]</A>.</FONT></P>[/If]</div> <!-- end center -->